<!doctype html>
<html>
  <head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=TAG_ID"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'TAG_ID');
    </script>
    <title>Aryabhata</title>
    <meta name='apple-mobile-web-app-status-bar-style' content='black-translucent'/>
    <meta name='theme-color' content='#7C614D'/> <!-- Safari navbar theme -->
    <meta name="apple-mobile-web-app-capable" content="yes"/> <!-- i(Pad)OS web app -->
    <meta name="format-detection" content="telephone=no"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/> <!-- disable zoom -->

    <style>
      .shown {display: block};
      #bgcontainer {
        background: url(http://anantam.aeonic.me/bg.png);
      }
      
    </style>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <link href='http://aryabhata.aeonic.me/noedit.sigma.css' rel='stylesheet' type='text/css'/>
    <link
      rel='stylesheet'
      href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css'
    />
    <!-- Favicon and PWA Icon -->
    <link rel="icon" type="image/x-icon" href="http://aryabhata.aeonic.me/assets/favicon.ico"/>
    <link rel="apple-touch-icon" href="http://aryabhata.aeonic.me/assets/Aryabhata-app-icon.png"/>
  </head>
  <body>
    <div id='bgcontainer' style='background: url(http://anantam.aeonic.me/bg.png); filter: sepia(87%);'></div>
    <div class='container'>
      <div id='graphing' class='content-section active'>
        <h1 class="page-title">Graphing</h1>
        <div class="desk-paper" style='line-height: 36pt;'>
          <div class='table-wrapper'>
            <table class='non' style='margin-left: auto; margin-right: auto; min-width: calc(100% - 60px);'>
              <thead>
                <tr>
                  <td class='viewport-input'><strong>x-i viewport</strong></td>
                  <td><strong>x-r trace</strong></td>
                  <td><strong>x-i trace</strong></td>
                  <td onclick='graphFunction();' style='cursor: pointer;'><strong>graph</strong></td>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td id='xiv-td' class='viewport-input'>
                    <div id='xiv-td-content'>
                      x-iv: <input type='range' min='-36' max='36' value='0' step='1' id='xiv-input'/><br/>
                      x-iv = <span id='xiv-value'>0</span><br/>
                      <div class='graph-adv'>
                        x-iv Min: <input type='number' value='-36' id='xiv-min-input'/><br/>
                        x-iv Max: <input type='number' value='36' id='xiv-max-input'/><br/>
                        x-iv Step: <input type='number' value='1' min='0' id='xiv-step-input'/><br/>
                      </div>
                      <input type='checkbox' id='xiv-type-input' checked='checked'/> <label for='xiv-type-input'>Slider input?</label>
                    </div>
                  </td>
                  <td id='xr-td'>
                    x-r: <input type='range' min='-36' max='36' value='0' step='1' id='xr-input'/><br/>
                    x-r = <span id='xr-value'>0</span><br/>
                    <div class='graph-adv'>
                      x-r Min: <input type='number' value='-36' id='xr-min-input'/><br/>
                      x-r Max: <input type='number' value='36' id='xr-max-input'/><br/>
                      x-r Step: <input type='number' value='1' min='0' id='xr-step-input'/><br/>
                    </div>
                    <input type='checkbox' id='xr-type-input' checked='checked'/> <label for='xr-type-input'>Slider input?</label>
                  </td>
                  <td id='xi-td'>
                    x-i: <input type='range' min='-36' max='36' value='0' step='1' id='xi-input'/><br/>
                    x-i = <span id='xi-value'>0</span><br/>
                    <div class='graph-adv'>
                      x-i Min: <input type='number' value='-36' id='xi-min-input'/><br/>
                      x-i Max: <input type='number' value='36' id='xi-max-input'/><br/>
                      x-i Step: <input type='number' value='1' min='0' id='xi-step-input'/><br/>
                    </div>
                    <input type='checkbox' id='xi-type-input' checked='checked'/> <label for='xi-type-input'>Slider input?</label>
                  </td>
                  <td rowspan='2' style='border-radius: 6px 6px 9px 6px;'>
                    <center>
                      Minor step: <input id='graph-minor-step' type='number' min='0' step='0.5' value='1' title='distance between thinner gridlines. set to 0 to disable them entirely.'/><br/>
                      Major step: <input id='graph-major-step' type='number' min='0' value='6' title='distance between thicker gridlines. set to 0 to disable them entirely.'/>
                      <span id='graph-xryr-offset-div-container-span'>
                        <div id='graph-xryr-offset-div'>
                          xr-offset: <input id='graph-offset-xr' type='number' step='1' value='0'/><br/>
                          yr-offset: <input id='graph-offset-yr' type='number' step='1' value='0'/><br/>
                          yi-offset: <input id='graph-offset-yi' type='number' step='1' value='0'/>
                        </div>
                      </span>
                      <button id='graph-btn' onclick='graphFunction();'>Graph</button>
                      <div class='graph-adv'>
                        <hr/>
                        Tick height: <input id='graph-tick-height' type='number' step='0.5' value='2.5'/><br/>
                        <form>
                          X-axis<br/>
                          <input type='radio' name='graph-dimension-x' id='graph-dimension-xr' checked='checked'/><label for='graph-dimension-xr'>Real only</label><br/>
                          <input type='radio' name='graph-dimension-x' id='graph-dimension-xi'/><label for='graph-dimension-xi'>Imaginary only</label><br/>
                        </form><br/>
                        <form>
                          Y-axis<br/>
                          <input type='radio' name='graph-dimension-y' id='graph-dimension-yr' checked='checked'/><label for='graph-dimension-yr'>Real only</label><br/>
                          <input type='radio' name='graph-dimension-y' id='graph-dimension-yi'/><label for='graph-dimension-yi'>Imaginary only</label><br/>
                        </form><br/>
                        <input id='graph-dimension-3d' type='checkbox'/> <label for='graph-dimension-3d'>Enable 3D?</label><br/>
                      </div>
                      <hr/>
                      <input id='graph-ticks' type='checkbox' checked='checked'/> <label for='graph-ticks'>Tick marks?</label><br/>
                      <input id='graph-grids' type='checkbox' checked='checked'/> <label for='graph-grids'>Grid lines?</label><br/>
                      <input id='graph-points' type='checkbox' checked='checked'/> <label for='graph-points'>Graph points?</label><br/>
                      <input id='graph-scroll-xiv' type='checkbox'/> <label for='graph-scroll-xiv'>Scroll for x-iv?</label><br/>
                      <input id='graph-auto' type='checkbox' checked='checked'/> <label for='graph-auto' title='resource-consuming'>Graph automatically?</label><br/>
                      <input id='graph-advanced' type='checkbox'/> <label for='graph-advanced'>Advanced options?</label><br/>
                    </center>
                  </td>
                </tr>
                <tr class='merged'>
                  <td class='viewport-input' colspan='2'>
                    <center>
                      <strong>Function</strong><br/>
                      <div id='function-wrapper'>
                        <p class='equation' id='function-1'>
                          <span id='function-name-1'>f</span>(x) = <input id='function-input-1' type='text' value='0.37x^2 - 10x'/>
                          <select id='function-colour-1'>
                            <optgroup label='Mute colours'>
                              <option value='#f09393ff'>pink</option>
                              <option value='#CB4C4Eff'>red</option>
                              <option value='#D25339ff'>orange</option>
                              <option value='#CF812Eff'>yellow</option>
                              <option value='#4CAB4Eff'>green</option>
                              <option value='#4D7C8Dff'>teal</option>
                              <option value='#4E4CCBff'>blue</option>
                              <option value='#614CC5ff'>indigo</option>
                              <option value='#7E4CBCff'>violet</option>
                              <option value='#AD4CADff' selected='selected'>purple</option>
                              <option value='#808080ff'>grey</option>
                              <option value='#9A4CB3ff'>maroon</option>
                              <option value='#A16C4Eff'>brown</option>
                              <option value='#273236ff'>black</option>
                              <option value='#d8cdc9ff'>white</option>
                            </optgroup>
                            <optgroup label='Saturated colours'>
                              <option value='#ff69b4ff'>hot pink</option>
                              <option value='#ff0000ff'>hot red</option>
                              <option value='#DD8800ff'>hot orange</option>
                              <option value='#66AA00ff'>hot yellow</option>
                              <option value='#00ff00ff'>hot green</option>
                              <option value='#00c0c0ff'>hot teal</option>
                              <option value='#0000ffff'>hot blue</option>
                              <option value='#4000EAff'>hot indigo</option>
                              <option value='#8000D5ff'>hot violet</option>
                              <option value='#c000c0ff'>hot purple</option>
                              <option value='#c0c0c0ff'>hot grey</option>
                              <option value='#800000ff'>hot maroon</option>
                              <option value='#6c3b1cff'>hot brown</option>
                              <option value='#000000ff'>hot black</option>
                              <option value='#ffffffff'>hot white</option>
                            </optgroup>
                            <optgroup label='Pastel colours'>
                              <option value='#f2b1b1ff'>pastel pink</option>
                              <option value='#FAA0A01ff'>pastel red</option>
                              <option value='#FDAA77ff'>pastel orange</option>
                              <option value='#FED8B2ff'>pastel yellow</option>
                              <option value='#77dd77ff'>bright green</option>
                              <option value='#75dad7ff'>bright teal</option> <!--279e9d, 4ebcba-->
                              <option value='#a7c7e7ff'>pastel blue</option>
                              <option value='#8686afff'>pastel indigo</option>
                              <option value='#ab9678ff'>pastel violet</option>
                              <option value='#ffd2cfff'>pastel purple</option>
                              <option value='#f3cfceff'>pastel grey</option>
                            </optgroup>
                            <optgroup label='Opacity'>
                              <option value='#c0c0c080'>translucent</option>
                              <option value='#ffffff00'>transparent</option>
                            </optgroup>
                          </select>
                          <button class='fa fa-eye' disabled='disabled' id='function-delete-1'></button>
                        </p>
                      </div>
                      <button class='fa fa-plus' id='equation-new' onclick='addNewFunction();'></button>
                    </center>
                  </td>
                  <td style='border-radius: 6px;'>
                    <center id='graph-scale-span-container'>
                      <strong>Trace</strong><br/>
                      x: <span id='xri-showcase'>? + ?i</span><br/>
                      y: <span id='yri-showcase'>? + ?i</span><br/>
                      <hr/>
                      Round: 10<sup><input id='trace-round' type='number' style='font-size: calc(inherit * 0.25);' min='-4' value='-1' step='1'/></sup>
                      <span id='graph-scale-span'>
                        <hr/>
                        <span id='graph-scale-span-sub'>
                          Scale: <input type='number' id='graph-scale' value='5' step='1'/><br/>
                        </span>
                        <br/>
                        <!--Density: <input type='number' id='graph-density' value='10' step='1'/>-->
                      </span>
                    </center>
                  </td>
                  
                </tr>
              </tbody>
            </table>
          </div>
          <center id='graph-container'>
            <div id='graph-div'>
              <canvas height='360' width='360' style='border: 1px solid grey;' id='graph-canvas'></canvas>
            </div>
            <!--<button id='graph-fullscreen-btn'><i class='fa fa-expand'></i> Fullscreen</button>-->
          </center>
        </div>
      </div>

        <!-- modal for the fullscreen graph (indented 1 extra) -->
        <center>
          <div class='modal-container hidden' id='graph-fullscreen-modal-container'>
            <div id='graph-fullscreen-modal' class='modal hidden'>
            </div>
          </div>
        </center>

      <script>
        // Axes and Trace Variables
        var xr = 0, xrp = 0; // x real (x axis)
        var xi = 0, xip = 0; // x imaginary (z axis)
        var yr = 0, yrp = 0; // y real (y axis)
        var yi = 0, yip = 0; // y imaginary (t axis)

        var xiv = 0, xivp = 0; // x imaginary viewport
        var inputs = ['xi', 'xr', 'xiv']; // each instance of the slider setup thing

        var xrmin = -36, xrmax = 36; // x-real minimum/maximum
        var ximin = -36, ximax = 36; // x-imaginary minimum/maximum

        var scale = 5; // how zoomed in the graph is
        var inputScale = 1;

        var fullscreen = false; // est-on plein écran (fullscreen) ou non

        var nof = 1; // number of functions

        // Convenience stuff
        const $ = (selector) => document.querySelector(selector);

        // Canvas Declaration
        const canvas = document.getElementById('graph-canvas');
        const ctx = canvas.getContext('2d');
        var canvasWidth = 360;
        var canvasHeight = 360;
        ctx.translate(canvas.width/2, canvas.height/2);
        var do3D = false;
        var toffxr = 0; // total xr-offset
        var toffyr = 0; // total yr-offset
        var toffyi = 0; // total yi-offset

        window.addEventListener('load', function() {
          // Utiliser HTTP en lieu d'HTTPS à cause de l'HTTP est incompatible avec mon domain
          //if (window.location.href.slice(0, 5) !== 'http:') window.location.href = 'http://' + window.location.href.slice(8);

          // Graph at the start
          graphFunction();
          inputsAutoGraphTest();

          // Open the home tab
          document.querySelector('#homeTab').click();

          document.querySelectorAll('.graph-adv').forEach(function(element) {
              element.classList.add('hidden');
          });
          setInterval(function() {
            // Update whether graph is 2D or 3D
            if ($('#graph-dimension-3d').checked == true) {
              do3D = true;
            }
            else {
              do3D = false;
            }
            // Update whether to show the graph button
            if ($('#graph-auto').checked != true) {
              $('#graph-btn').style.display = 'block';
            }
            else {
              $('#graph-btn').style.display = 'none';
            }

          }, 37);
          
          function inputsAutoGraphTest () {
            document.querySelectorAll('#graphing input[type=text], #graphing input[type=number], #graphing input[type=checkbox], #graphing select, #fullscreen-modal input, #xiv-td input').forEach(input => {
              input.addEventListener('input', function () {
                // if the user selects to graph automatically (resource-consuming)
                if ($('#graph-auto').checked) graphFunction();
              });
            });
          }

          document.querySelectorAll('#graphing input[type=range], #graphing td input[type=number]:first-of-type').forEach(input => {
            input.addEventListener('input', function () {
              // NO MORE ~~~~Continuously (every 37 ms) check for changes in xr,xi,yr,yi and push to span~~~~
              updateTrace();
            });
          });


          $('#graphing').addEventListener('mouseover', function () {
            if (pregraphed == false) pregraphed = true;
            graphFunction();
          });

          $('#xi-input').addEventListener('input', function () {
            xi = Number(this.value);
            $('#xi-value').innerHTML = xi
            
          });

          $('#xr-input').addEventListener('input', function () {
            xr = Number(this.value);
            $('#xr-value').innerHTML = xr;
          });

          $('#xiv-input').addEventListener('input', function () {
            xiv = Number(this.value);
            $('#xiv-value').innerHTML = xiv;
          });

          $('#graph-minor-step').addEventListener('input', function () {
            $('#graph-major-step').step = this.value;
          });

          $('#graph-offset-xr').addEventListener('input', function () {
            toffxr = Number(this.value);
            resetOffset();
            ctx.translate(toffxr, 0);
            graphFunction();
          });

          $('#graph-offset-yr').addEventListener('input', function () {
            toffyr = Number(this.value);
            resetOffset();
            ctx.translate(0, toffyr);
            graphFunction();
          });

          document.querySelectorAll('#graph-canvas').forEach(fsBtn => {
            fsBtn.addEventListener('click', function () {
              fullscreen = !fullscreen;
              var modal = $('#graph-fullscreen-modal');
              var container = $('#graph-container');
              var scaleContainer = $('#graph-scale-span-container');
              var scaleContainerSub = $('#graph-scale-span-sub');
              modal.classList.toggle('hidden');
              modal.parentElement.classList.toggle('hidden');
              if (fullscreen) { // if fullscreen is now entered
                modal.innerHTML = '';
                modal.appendChild($('#graph-div'));
                modal.appendChild($('#graph-scale-span'));
                modal.appendChild($('#xiv-td-content'));
                modal.appendChild($('#graph-xryr-offset-div'));
                modal.appendChild(canvas);
                document.body.style.overflowY = 'hidden';
                //this.innerHTML = '<i class="fa fa-compress" style="z-index: 250;"></i> Exit';
                canvas.style.transform = 'scale(' + $('#graph-scale').value + ')';
                /*scaleContainerSub.style.position = 'relative';
                scaleContainerSub.style.top = '-20px';
                scaleContainerSub.style.left = 'calc(' + modal.parentElement.offsetWidth / 2 + ' - ' + this.offsetWidth / 2 + 'px)';
                $('#xiv-td-content').style.position = 'relative';
                $('#xiv-td-content').style.top = '-10px';
                $('#xiv-td-content').style.left = 'calc(' + modal.parentElement.offsetWidth / 2 + ' - ' + this.offsetWidth / 2 + 'px)';
                $('#graph-xryr-offset-div').style.position = 'relative';
                $('#graph-xryr-offset-div').style.bottom = '-10px';
                $('#graph-xryr-offset-div').style.left = 'calc(' + modal.parentElement.offsetWidth / 2 + ' - ' + this.offsetWidth / 2 + 'px)';*/
                /*
                Old Graph Fullscreen Button
                this.style.position = 'fixed';
                this.style.bottom = '10px';
                this.style.marginLeft = 'auto;'
                this.style.marginRight = 'auto;'*/
              }
              else { // when exiting fullscreen
                //container.appendChild($('#graph-fullscreen-btn'));
                container.appendChild($('#graph-div'));
                $('#graph-div').appendChild(canvas);
                scaleContainer.appendChild($('#graph-scale-span'));
                $('#xiv-td').appendChild($('#xiv-td-content'));
                $('#graph-xryr-offset-div-container-span').appendChild($('#graph-xryr-offset-div'));
                document.body.style.overflowY = 'scroll';
                canvas.style.transform = 'scale(1)';
                scaleContainerSub.style.position = 'static';
                //this.style.position = 'static';
                //this.innerHTML = '<i class="fa fa-expand"></i> Fullscreen';
              }
            });
          });

          $('#graph-scale').addEventListener('input', function () {
            var newScale = this.value;
            if (this.value <= 0) this.value = scale;
            if (newScale <= 0) newScale = scale;
            scale = newScale;
            graphFunction();
            /*var modal = $('#graph-fullscreen-modal');
            var scaleContainer = $('#graph-scale-span-container');
            var prevValue = inputScale;
            inputScale = this.value;
            this.max =  round(modal.offsetWidth ** 2, 1);
            this.min = round(1 / $('#graph-scale').max, 1);
            if (this.min < 0) this.min = 0;
            if (this.max > 2) this.max = 2;
            if (this.value <= this.min) this.value = this.min;
            if (this.value >= this.max) this.value = this.max;
            if (fullscreen) canvas.style.transform = 'scale(' + $('#graph-scale').value + ')';
            else canvas.style.transform = 'scale(1)';*/
          });

          canvas.addEventListener('wheel', function (e) {
            e.preventDefault();
            if ($('#graph-scroll-xiv').checked) { // originally fullscreen != true
              // Vertical scrolling
              if (e.deltaY > 0) {
                // Scroll down; ideally decrease y-i viewport
                xiv -= Number($('#xiv-step-input').value);
                if (xiv <= $('#xiv-min-input').value) xiv = Number($('#xiv-min-input').value);
                $('#xiv-input').value = xiv;
                $('#xiv-value').innerHTML = xiv;
              }
              else if (e.deltaY < 0) {
                // Scroll up; ideally increase y-i viewport
                xiv += Number($('#xiv-step-input').value);
                if (xiv >= $('#xiv-max-input').value) xiv = Number($('#xiv-max-input').value);
                $('#xiv-input').value = xiv;
                $('#xiv-value').innerHTML = xiv;
              }
              // Horizontal scrolling
              if (e.deltaX > 0) {
                // Scroll left; decrease x-i viewport
                xiv -= Number($('#xiv-step-input').value);
                if (xiv <= $('#xiv-min-input').value) xiv = Number($('#xiv-min-input').value);
                $('#xiv-input').value = xiv;
                $('#xiv-value').innerHTML = xiv;
              }
              else if (e.deltaX < 0) {
                // Scroll right; increase x-i viewport
                xiv += Number($('#xiv-step-input').value);
                if (xiv >= $('#xiv-max-input').value) xiv = Number($('#xiv-max-input').value);
                $('#xiv-input').value = xiv;
                $('#xiv-value').innerHTML = xiv;
              }
            }
            else if ($('#graph-scroll-xiv').checked != true) { // originally fullscreen == true
              // Vertical scrolling
              if (e.deltaY > 0) {
                // Scroll down; ideally decrease yr offset
                toffyr -= Number($('#graph-offset-yr').step);
                //if (toffyr <= $('#offset-yr').min) toffyr = Number($('#xiv-min-input').value);
                $('#graph-offset-yr').value = toffyr;
              }
              else if (e.deltaY < 0) {
                // Scroll up; ideally increase yr offset
                toffyr += Number($('#graph-offset-yr').step);
                //if (toffyr >= $('#offset-yr').max) toffyr = Number($('#xiv-max-input').value);
                $('#graph-offset-yr').value = toffyr;
              }
              // Horizontal scrolling
              if (e.deltaX > 0) {
                // Scroll left; ideally decrease xr offset
                toffxr -= Number($('#graph-offset-xr').step);
                //if (xiv <= $('#xiv-min-input').value) xiv = Number($('#xiv-min-input').value);
                $('#graph-offset-xr').value = toffxr;
              }
              else if (e.deltaX < 0) {
                // Scroll right; ideally increase xr offset
                toffxr += Number($('#graph-offset-xr').step);
                //if (toffxr >= $('#xiv-max-input').value) toffxr = Number($('#xiv-max-input').value);
                $('#graph-offset-xr').value = toffxr;
              }
              graphFunction();
            }
            graphFunction();
          });

          $('#xiv-td').addEventListener('mousewheel', function (e) {
            // Horizontal scrolling
            if (event.deltaX > 0) {
              // Scroll left
              xiv -= Number($('#xiv-step-input').value);
              if (xiv <= $('#xiv-min-input').value) xiv = Number($('#xiv-min-input').value);
              $('#xiv-input').value = xiv;
              $('#xiv-value').innerHTML = xiv;
            }
            else if (event.deltaX < 0) {
              // Scroll right
              xiv += Number($('#xiv-step-input').value);
              if (xiv >= $('#xiv-max-input').value) xiv = Number($('#xiv-max-input').value);
              $('#xiv-input').value = xiv;
              $('#xiv-value').innerHTML = xiv;
            }
            graphFunction();
          });

          $('#xr-td').addEventListener('mousewheel', function (e) {
            // Horizontal scrolling
            if (event.deltaX > 0) {
              // Scroll left
              xr -= Number($('#xr-step-input').value);
              if (xr <= $('#xr-min-input').value) xr = Number($('#xr-min-input').value);
              $('#xr-input').value = xr;
              $('#xr-value').innerHTML = xr;
            }
            else if (event.deltaX < 0) {
              // Scroll right
              xr += Number($('#xr-step-input').value);
              if (xr >= $('#xr-max-input').value) xr = Number($('#xr-max-input').value);
              $('#xr-input').value = xr;
              $('#xr-value').innerHTML = xr;
            }
            updateTrace();
          });

          $('#xi-td').addEventListener('mousewheel', function (e) {
            // Horizontal scrolling
            if (event.deltaX > 0) {
              // Scroll left
              xi -= Number($('#xi-step-input').value);
              if (xi <= $('#xi-min-input').value) xi = Number($('#xi-min-input').value);
              $('#xi-input').value = xi;
              $('#xi-value').innerHTML = xi;
            }
            else if (event.deltaX < 0) {
              // Scroll right
              xi += Number($('#xi-step-input').value);
              if (xi >= $('#xi-max-input').value) xi = Number($('#xi-max-input').value);
              $('#xi-input').value = xi;
              $('#xi-value').innerHTML = xi;
            }
            updateTrace();
          });

          $('#graph-advanced').addEventListener('input', function () {
            const graphAdvElements = document.querySelectorAll('.graph-adv');
            
            if (!this.checked) {
                graphAdvElements.forEach(function(element) {
                    element.classList.add('hidden');
                });
            } else {
                graphAdvElements.forEach(function(element) {
                    element.classList.remove('hidden');
                });
            }
        });

          function resetOffset () {
            ctx.translate(-toffxr, -toffyr);
          }

          function inputSetup (prefix) {
            // Change xi minimum
            $('#' + prefix + '-min-input').addEventListener('input', function () {
              $('#' + prefix + '-input').min = Number($('#' + prefix + '-min-input').value);
              $('#' + prefix + '-max-input').min = $('#' + prefix + '-input').min;
            });

            // Change xi maximum
            $('#' + prefix + '-max-input').addEventListener('input', function () {
              $('#' + prefix + '-input').max = Number($('#' + prefix + '-max-input').value);
              $('#' + prefix + '-min-input').max = $('#' + prefix + '-input').max;
            });

            // Change xi step
            $('#' + prefix + '-step-input').addEventListener('input', function () {
              $('#' + prefix + '-input').step = Number($('#' + prefix + '-step-input').value);
            });

            // Change xi input type
            $('#' + prefix + '-type-input').addEventListener('input', function () {
              if ($('#' + prefix + '-type-input').checked != true && $('#' + prefix + '-type-input').checked != 'checked') {
                $('#' + prefix + '-input').type = 'number';
                $('#' + prefix + '-input').removeAttribute('min');
                $('#' + prefix + '-input').removeAttribute('max');
                $('#' + prefix + '-min-input').disabled = 'disabled';
                $('#' + prefix + '-max-input').disabled = 'disabled';
              }
              else {
                $('#' + prefix + '-input').type = 'range';
                $('#' + prefix + '-min-input').removeAttribute('disabled');
                $('#' + prefix + '-max-input').removeAttribute('disabled');
                if (Number($('#' + prefix + '-input').value) > Number($('#' + prefix + '-max-input').value)) {
                  $('#' + prefix + '-max-input').value = $('#' + prefix + '-input').value;
                }
                if (Number($('#' + prefix + '-input').value) < Number($('#' + prefix + '-min-input').value)) {
                  $('#' + prefix + '-min-input').value = $('#' + prefix + '-input').value;
                }
                
                $('#' + prefix + '-input').max = Number($('#' + prefix + '-max-input').value);
                $('#' + prefix + '-input').min = Number($('#' + prefix + '-min-input').value);
              }
            });
          }
          for (var i = 0; i < inputs.length; i++) {
            inputSetup(inputs[i]);
          }
        });

        // Alphabetical function
        function alphabet (index, funcInstead) {
          // get the Latin alphabet in unicode
          index += 96;
          if (funcInstead) index += 5;
          const codePoint = index.toString(16);
          return '&#x' + codePoint + ';';
        }

        // Add new function
        function addNewFunction () {
          nof++;
          let char = alphabet(nof, true);
          $('#function-wrapper').innerHTML += '<p class="equation" id="function-' + nof + '"><span id="function-name-' + nof + '">' + char + '</span>(x) = <input id="function-input-' + nof + '" type="text" style="font-family:times" value="x - ' + nof + '" oninput="graphFunction();"><select id="function-colour-' + nof + '" onclick="graphFunction();"><optgroup label="Mute colours"><option value="#f09393ff">pink<option value="#CB4C4Eff">red<option value="#D25339ff">orange<option value="#CF812Eff">yellow<option value="#4CAB4Eff">green<option value="#4D7C8Dff">teal<option value="#4E4CCBff">blue<option value="#614CC5ff">indigo<option value="#7E4CBCff">violet<option value="#AD4CADff"selected>purple<option value="#808080ff">grey<option value="#9A4CB3ff">maroon<option value="#A16C4Eff">brown<option value="#273236ff">black<option value="#d8cdc9ff">white<optgroup label="Saturated colours"><option value="#ff69b4ff">hot pink<option value="#ff0000ff">hot red<option value="#DD8800ff">hot orange<option value="#66AA00ff">hot yellow<option value="#00ff00ff">hot green<option value="#00c0c0ff">hot teal<option value="#0000ffff">hot blue<option value="#4000EAff">hot indigo<option value="#8000D5ff">hot violet<option value="#c000c0ff">hot purple<option value="#c0c0c0ff">hot grey<option value="#800000ff">hot maroon<option value="#6c3b1cff">hot brown<option value="#000000ff">hot black<option value="#ffffffff">hot white<optgroup label="Pastel colours"><option value="#f2b1b1ff">pastel pink<option value="#FAA0A01ff">pastel red<option value="#FDAA77ff">pastel orange<option value="#FED8B2ff">pastel yellow<option value="#77dd77ff">bright green<option value="#75dad7ff">bright teal<option value="#a7c7e7ff">pastel blue<option value="#8686afff">pastel indigo<option value="#ab9678ff">pastel violet<option value="#ffd2cfff">pastel purple<option value="#f3cfceff">pastel grey<optgroup label="Opacity"><option value="#c0c0c080">translucent<option value="#ffffff00">transparent</select><button class="fa fa-eye" id="function-delete-' + nof + '" oninput="graphFunction();"></button></p>';
          if (nof > 1) $('#function-delete-1').removeAttribute('disabled');
          else $('#function-delete-1').disabled = 'disabled';
          if ($('#graph-auto').checked) graphFunction();
          inputsAutoGraphTest();
        }

        function drawGrid (majorStep, minorStep) {
          var imax = toffxr * 5;
          var imay = toffyr * 5;
          var mS;
          if (minorStep != undefined) {
            mS = minorStep;
          }
          else {
            mS = 1;
          }
          //ctx.translate(0, 0);
          // Draw the x and y axes
          // xr-axis
          ctx.beginPath();
          ctx.moveTo(-canvas.width - imax, 0);
          ctx.lineTo(canvas.width - imax, 0);
          ctx.strokeStyle = 'blue';
          ctx.lineWidth = 2;
          ctx.stroke();

          // yr-axis
          ctx.beginPath();
          ctx.moveTo(0, -canvas.height - imay);
          ctx.lineTo(0, canvas.height - imay);
          ctx.strokeStyle = 'red';
          ctx.lineWidth = 2;
          ctx.stroke();

          // Draw all of the gridlines
          for (var i = -canvas.width/2 - imay; i < canvas.width/2 - imay; i += 5) {
            ctx.strokeStyle = 'grey';
            // Determine whether to do major or minor lines
            if ((i/5) % majorStep == 0) ctx.lineWidth = 0.25;
            else if ((i/5) % mS == 0) ctx.lineWidth = 0.125;
            else ctx.lineWidth = 0.03125;
            if ($('#graph-grids').checked) {
              // Draw quadrants I and IV
              // Horizontal
              ctx.beginPath();
              ctx.moveTo(-canvas.width + toffxr, i);
              ctx.lineTo(canvas.width + toffxr, i);
              ctx.stroke();
              // Draw quadrants II and III
              // Horizontal
              ctx.beginPath();
              ctx.moveTo(-canvas.width - toffxr, i);
              ctx.lineTo(canvas.width - toffxr, i);
              ctx.stroke();
            }
            // Draw tick marks if selected
            if ($('#graph-ticks').checked && (i/5) % mS == 0) {
              // Number($('#graph-tick-height').value)
              ctx.lineWidth = 0.5;
              // Draw quadrants I and IV
              // Horizontal
              ctx.strokeStyle = 'red';
              ctx.beginPath();
              ctx.moveTo(-Number($('#graph-tick-height').value), i);
              ctx.lineTo(Number($('#graph-tick-height').value), i);
              ctx.stroke();
              // Draw quadrants II and III
              ctx.strokeStyle = 'red';
              ctx.beginPath();
              ctx.moveTo(-Number($('#graph-tick-height').value), i);
              ctx.lineTo(Number($('#graph-tick-height').value), i);
              ctx.stroke();
            }
          }
          for (var i = -canvas.height/2 - imax; i < canvas.height/2 - imax; i += 5) {
            ctx.strokeStyle = 'grey';
            // Determine whether to do major or minor lines
            if ((i/5) % majorStep == 0) ctx.lineWidth = 0.25;
            else if ((i/5) % mS == 0) ctx.lineWidth = 0.125;
            else ctx.lineWidth = 0.03125;
            if ($('#graph-grids').checked) {
              // Draw quadrants I and IV
              // Vertical
              ctx.beginPath();
              ctx.moveTo(i, -canvas.height - toffyr);
              ctx.lineTo(i, canvas.height - toffyr);
              ctx.stroke();
              // Draw quadrants II and III
              // Vertical
              ctx.beginPath();
              ctx.moveTo(-1 * i, -canvas.height - toffyr);
              ctx.lineTo(-1 * i, canvas.height - toffyr);
              ctx.stroke();
            }
            // Draw tick marks if selected
            if ($('#graph-ticks').checked && (i/5) % mS == 0) {
              // Number($('#graph-tick-height').value)
              ctx.lineWidth = 0.5;
              // Draw quadrants I and IV
              // Vertical
              ctx.strokeStyle = 'blue';
              ctx.beginPath();
              ctx.moveTo(i, -Number($('#graph-tick-height').value));
              ctx.lineTo(i, Number($('#graph-tick-height').value));
              ctx.stroke();
              // Draw quadrants II and III
              // Vertical
              ctx.strokeStyle = 'blue';
              ctx.beginPath();
              ctx.moveTo(-1 * i, -Number($('#graph-tick-height').value));
              ctx.lineTo(-1 * i, Number($('#graph-tick-height').value));
              ctx.stroke();
            }
          }
        }

        function drawGrid3D () {
          // yi-axis
          ctx.beginPath();
          ctx.moveTo(canvas.height/2, canvas.height/4);
          ctx.lineTo(-canvas.height/2, -canvas.height/4);
          ctx.lineWidth = 1.75;
          ctx.strokeStyle = 'green';
          ctx.stroke();
          // c2 = sqrt(a2 + b2)
          const iidiag = Math.sqrt(180**2 + 90**2);
          const iictick = iidiag / 180; // iidiag's calculatory tick
          // make a triangle mathematically similar to iidiag's
          // hypotenuse = iictick
          // find legs (vertical a and horizontal 2a)
          // sqrt(a2 + 4a2) = iictick
          // a^2 + 4a^2 = iictick^2
          // 5a^2 = iictick^2
          // 5a = iictick
          // a = iictick/5
          const a = (iictick * Math.sqrt(5))/5;
          // i is the x position; j is the y position
          var j = 90;
          var k = 0;
          for (var i = -canvas.width/2; i < iidiag; i += (2*a)) {
            if ($('#graph-ticks').checked) {
              ctx.beginPath()
              if (k % 6 == 0) {
                ctx.moveTo(i, -j + Number($('#graph-tick-height').value));
                ctx.lineTo(i, -j - Number($('#graph-tick-height').value));
                //ctx.lineTo(i + (2*a), j - a);
                ctx.lineWidth = 1.5;
                ctx.stroke();
              }
            }
            j -= a;
            k ++;
          }
          /*for (var i = -canvas.width/2; i < 180; i += (2 * a)) {
            ctx.beginPath();
            ctx.moveTo(i, -5);
            ctx.lineTo(i + 2 * a, a+5);
            ctx.stroke();
          }*/
        }

        // Round numbers
        function round (num, p=0) {
          if (num == undefined) {
            return 0;
          }
          else {
            return Math.round(num * 10 ** -p) / 10 ** -p;
          }
        }
        function updateTrace () {
          var textx = '', texty = '';
          // Mirror the value of x
          if (xr != 0) {
            textx += xr.toString();
          }
          if (xi != 0) {
            textx += ' ';
            if (xi < 0) {
              textx += '- ' + ((-1) * xi).toString() + '<i>i</i>';
            }
            else if (xi > 0) {
              if (xr != 0) textx += '+ '
              textx += xi.toString() + '<i>i</i>';
            }
            else {
              //textx += ' ± ?i'
            }
          }
          if (xr == 0 && xi == 0) textx = '0'

          // Solve for y and then store it
          yr = solve(xr, xi, false);
          yi = solve(xr, xi, true);

          // Display the value of y
          if (yr != 0) {
            texty += yr.toString();
          }
          if (yr != 0) {
            texty += ' ';
            if (yi < 0) {
              texty += '- ' + ((-1) * yi).toString() + '<i>i</i>';
            }
            else if (yi > 0) {
              if (yr != 0) texty += '+ '
              texty += yi.toString() + '<i>i</i>';
            }
            else {
              //texty += ' ± ?i'
            }
          }
          if (yr == 0 && yi == 0) texty = '0'
          
          $('#xri-showcase').innerHTML = textx;
          $('#yri-showcase').innerHTML = texty;
        }
        // Solve the function for some X
        function countOccurrences(str, search) {
          return str.split(search).length - 1;
        }
        function solve (x, i, solveComplex, whence, whichFunction = 1, roundTo = Number($('#trace-round').value)) {
          if (whence == undefined) whence = 1;
          // Read the function input
          let scope = {
            x: math.complex(x, i),
            tet: tet,
          };
          var functext = $('#function-input-' + whichFunction).value.toString();
          // Number formatting
          functext = functext.replace(',',''); // Commas into nothings
          // Operations
          functext = functext.replace(/([\d\w\)\.]+)\s*\^\^\s*([\d\w\(\)\.]+)/g, 'tet($1,$2)'); // Tetration
          functext = functext.replace('{','(').replace('}', ')'); // Minimal LaTeX cross-compatibility
          functext = functext.replace(/\|([^|]+)\|/g, 'abs($1)'); // Absolute value
          // Constants
          functext = functext.replace(/c/, round('299792458', roundTo)); // Speed of Light (c)
          functext = functext.replace(/pi/, round('3.14159', roundTo)); // Pi
          functext = functext.replace(/tau/, round('6.28319', roundTo)); // Tau
          functext = functext.replace(/e/, round('2.71828', roundTo)); // e
          // Constant Functions
          if (countOccurrences(functext, 'x') == 0) functext = '(' + functext + ')x^0';
          // Finalise the function
          let func = math.evaluate(1 + '(' + functext + ')', scope);
          if (solveComplex == false || solveComplex == undefined) {
            return round(func.re, roundTo);
          }
          else {
            var a = round(func.im, roundTo);
            return round(func.im, roundTo);
          }
        }
        function isHole(num) {
          if (num == undefined || num == NaN || num == Infinity || num == -Infinity || num == null) return true;
          else return false;
        }

        function graphFunction () {
          // condition ? true : false

          // Stuff to do before graphing
          ctx.setTransform(1, 0, 0, 1, 0, 0);
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.translate(canvas.width/2 + scale * toffxr, canvas.height/2 + scale * toffyr);
          drawGrid(Number($('#graph-major-step').value), Number($('#graph-minor-step').value));

          // Loop to graph each function
          for (var f = 1; f <= nof; f++) {
            var colour = $('#function-colour-' + f).value;
            if (do3D) drawGrid3D();
            ctx.strokeStyle = colour;
            var preprecision = Number($('#trace-round').value);
            if (preprecision < -4) preprecision = -1;
            var precision = 5 * 10 ** preprecision;
            if (preprecision > 0) precision /= 5 * 5 ** (preprecision - 1);
            if (preprecision <= -1) precision = 2 ** (preprecision + 1);
            
            for (var i = -canvas.width/2 - $('#graph-offset-xr').value; i < canvas.width/2 - $('#graph-offset-xr').value; i += precision) {
              let width = 1;
              // The linear graph
              var xrt = i;
              var yrt = -solve(xrt, Number($('#xiv-input').value), false, 1, f);
              var yrit = -solve(xrt, Number($('#xiv-input').value), true, 1, f)
              var xrtNext = i + precision;
              var yrtNext = -solve(xrtNext, Number($('#xiv-input').value), false, 1, f);
              if ($('#graph-dimension-xi').checked) {
                yrt = -solve(Number($('#xiv-input').value), xrt, false, 1, f);
                yrtNext = -solve(Number($('#xiv-input').value), xrtNext, false, 1, f)
              }

              // Holes ( test and try (x-1)(x+1)/(x-1) )
              /*if (isHole(yrtNext) == true|| isHole(yrt) == true) {
                var xrtMext = i + 1 / 10 ** Number($('#trace-round').value);
                var yrtMext = -solve(xrtMext, Number($('#xiv-input').value), false, 1, f);
                
                if (isHole(yrtNext) == true) {
                  yrtNext = (yrtMext != undefined) ? yrtMext: 0;
                }
                if (isHole(yrt) == true) {
                  yrt = (yrtMext != undefined) ? yrtMext: 0;
                  ctx.beginPath();
                  ctx.arc(scale * xrt, scale * yrt, 2, 0, 2 * Math.PI);
                  ctx.fillStyle = $('#function-colour').value;
                  ctx.fill();
                  ctx.lineWidth = 0;
                  ctx.stroke();
                }
              }*/
              // Vertical asymptotes
              if (!isFinite(yrtNext) && yrtNext != undefined) {
                var xrtMext = i + 1 / 10 ** Number($('#trace-round').value);
                var yrtMext = -solve(xrtMext, Number($('#xiv-input').value), false, 1, f);
                yrtNext = (yrtMext > 0) ? -360 : 360;
              }

              else if (!isFinite(yrt) && yrt != undefined) {
                var xrtMext = i + 1 / 10 ** Number($('#trace-round').value);
                var yrtMext = -solve(xrtMext, Number($('#xiv-input').value), false, 1, f);
                yrt = (yrtMext > 0) ? 360 : -360;
              }
              if (yrit != -Number($('#xiv-input').value)) {
                ctx.strokeStyle = 'silver';
                ctx.lineWidth = width * 6;
              }
              else {
                ctx.strokeStyle = colour;
                ctx.lineWidth = width;
              }
              ctx.lineWidth = width;
              ctx.moveTo(scale * xrt, scale * yrt);
              ctx.lineTo(scale * xrtNext, scale * yrtNext);
              ctx.stroke();
              // The pointed graph
              if (i % Number($('#graph-minor-step').value) == 0 && $('#graph-points').checked) {
                // Positive x point
                ctx.beginPath();
                ctx.arc(scale * xrt, scale * yrt, 1.25, 0, 2 * Math.PI);
                ctx.fill();
                ctx.stroke();
                // Negative x point
                var xrtNeg = -i;
                var yrtNeg = -solve(xrtNeg, Number($('#xiv-input').value), false, 1, f);
                ctx.beginPath();
                ctx.arc(scale * xrtNeg, scale * yrtNeg, 1.25, 0, 2 * Math.PI);
                ctx.fill();
                ctx.stroke();
              }
            }
          }
        }
      </script>

      <!-- Scientific Calculator -->
      <div id='scientific' class='content-section'>
        <h1 class="page-title">Scientific</h1>
        <div class="desk-paper" style='line-height: 36pt;'>
          <form name="calculator" >
            <input type="textfield" id="resultFake" name="ansTwo" placeholder="0." style="width: 100%; font-family: display, futura, georgia; margin: 5px; padding: 10px; color: red; background: black; outline: 0;" readonly='readonly' oncontextmenu='return false;eToggle("ans", "block", "ansTwo", "none");'><br>
              <input type="textfield" id='result' name="ans" value="" style='width: 100%; display: none;' oncontextmenu='return false; eToggle("ansTwo", "block", "result", "none");'>
              <div class='table-wrapper'>
                <table class='non'>
                  <thead>
                    <tr>
                      <td><input type="button" value="=" onClick="document.calculator.ans.value=math.evaluate(document.calculator.ans.value);document.calculator.ansTwo.value=math.evaluate(document.calculator.ans.value)" title='Show solution: Equals Sign' class='calb caln'/></td>
                      <td><input type="button" value="⇧" onclick="toggleHyperMode();" title='Toggle Hyper mode' class='calb cala'/></td>
                      <td><input type="reset" value="↺" title='All Clear' class='calb caln'/></td><!--⎚-->
                      <td><input type="button" value="∧" title='AND' onClick="document.calculator.ans.value+='&';document.calculator.ansTwo.value+='∧';" class='calb calv'/></td>
                      <td><input type="button" value='∨' title="OR" onClick="document.calculator.ans.value+='|';document.calculator.ansTwo.value+='∨';" class='calb calv'/></td>
                    </tr>
                  </thead>
                  <tbody>
                    <tr class='numrow'>
                      <td><input type='button' value='1' onClick="document.calculator.ans.value+='1';document.calculator.ansTwo.value+='1';" class='calb caln'/></td>
                      <td><input type='button' value='2' onClick="document.calculator.ans.value+='2';document.calculator.ansTwo.value+='2';" class='calb caln'/></td>
                      <td><input type="button" value="3" onClick="document.calculator.ans.value+='3';document.calculator.ansTwo.value+='3';" class='calb caln'/></td>
                      <td><input type="button" value="+" onClick="document.calculator.ans.value+='+';document.calculator.ansTwo.value+='+';" class='calb calo'/></td>
                      <td><input type="button" value="¬" title='NOT' onClick="document.calculator.ans.value+='!';document.calculator.ansTwo.value+='¬';" class='calb calv'/></td>
                      
                    </tr>
                    <tr class='numrow'>
                      <td><input type="button" value="4" onClick="document.calculator.ans.value+='4';document.calculator.ansTwo.value+='4';" class='calb caln'/></td>
                      <td><input type="button" value="5" onClick="document.calculator.ans.value+='5';document.calculator.ansTwo.value+='5';" class='calb caln'/></td>
                      <td><input type="button" value="6" onClick="document.calculator.ans.value+='6';document.calculator.ansTwo.value+='6';" class='calb caln'/></td>
                      <td><input type="button" value="-" onClick="document.calculator.ans.value+='-';document.calculator.ansTwo.value+='-';" class='calb calo'/></td>
                      <!--<td><input type="button" value="ⁿa" onClick="document.calculator.ans.value+='tet(';document.calculator.ansTwo.value+='tet(';" class="calo" title="Tetration"/></td>-->
                      <td><input type="button" value="⊕" title='XOR' onClick="document.calculator.ans.value+='~';document.calculator.ansTwo.value+='⊕';" class='calb calv'/></td>
                    </tr>
                    <tr class='numrow'>
                      <td><input type="button" value="7" onClick="document.calculator.ans.value+='7';document.calculator.ansTwo.value+='7';" class='calb caln'/></td>
                      <td><input type="button" value="8" onClick="document.calculator.ans.value+='8';document.calculator.ansTwo.value+='8';" class='calb caln'/></td>
                      <td><input type="button" value="9" onClick="document.calculator.ans.value+='9';document.calculator.ansTwo.value+='9';" class='calb caln'/></td>
                      <td><input type="button" value="&times;" onClick="document.calculator.ans.value+='*';document.calculator.ansTwo.value+='&bull;';" class='calb calo'/></td>
                      <td><input type="button" value="aⁿ" onClick="document.calculator.ans.value+='^';document.calculator.ansTwo.value+='^';" class='calb calo'/></td>                    
                    </tr>
                    <tr class='numrow'>
                      <td><input type='button' value='.' onClick="document.calculator.ans.value+='.';document.calculator.ansTwo.value+='.';" title='Decimal' class='calb cala'/></td>
                      <td><input type="button" value="0" onClick="document.calculator.ans.value+='0';document.calculator.ansTwo.value+='0';" title='Zero' class='calb caln'/></td>
                      <td><input type='button' value=',' onClick="document.calculator.ans.value+=',';document.calculator.ansTwo.value+=',';" title='Comma' class='calb cala'/></td>
                      <td><input type="button" value="÷" onClick="document.calculator.ans.value+='/';document.calculator.ansTwo.value+='÷';" class='calb calo'/></td>
                      <td><input type="button" value="R" onClick="document.calculator.ans.value+='%';document.calculator.ansTwo.value+='mod';" class='calb calo'/></td>
                    </tr>
                    <tr class='numrow'>
                      <td><input type='button' value='(' onClick="document.calculator.ans.value+='(';document.calculator.ansTwo.value+='(';" title='Opening Parentheses' class='calb cala'/></td>
                      <td><input type='button' value=')' onClick="document.calculator.ans.value+=')';document.calculator.ansTwo.value+=')';" title='Closing Parentheses' class='calb cala'/></td>
                      <td><input type='button' value='&pi;' onclick='document.calculator.ans.value+="3.14159265358979323846264";document.calculator.ansTwo.value+="&pi;";'  class='calb cala'/></td>
                      <td><input type="button" value="e" onclick="document.calculator.ans.value+='2.71828182845904523536028';document.calculator.ansTwo.value+='e';" class='calb cala'/></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </form>
        </div>
        <script>
          // Scientific Calculator
          function tetOld(x,y) {
            if (y == 2) {
              return x ** y;
            }
            else if (y == 1) {return x;}
            else {
              var r = BigInt(x); // r = result of exponentiation
              for (var i=0n; i <= BigInt(y-2); i++) {
                r = BigInt(x ** r);
              }
              if (y == 0) {return 1;}
              return r;
            }
          }
          function tet(x, a, precision = 100) {
            x = math.complex(x);
            a = math.complex(a);

            // Handle base cases
            if (math.equal(a, 0)) return math.complex(1);
            if (math.equal(a, 1)) return x;

            // Use an approximation method:
            // f_{n+1}(x) = x^f_n(x), start with initial guess
            let z = math.complex(1); // initial guess

            for (let i = 0; i < precision; i++) {
              z = math.pow(x, z);
              if (!z.isFinite()) break;
            }

            // If a is integer, we can iterate normally
            if (math.isInteger(a.re) && a.im === 0 && a.re > 0) {
              let result = x;
              for (let i = 1; i < a.re; i++) {
                result = math.pow(x, result);
              }
              return result;
            }

            // For fractional/complex heights, return fixed point approximation
            return z;
          }
          function nrt(exp, num) {
            Math.pow(exp, 1/num);
          }
          function factorial (a) {
            var i = 1;
            while (i <= a) {
              r = BigInt(r * i); // Multiply result by the current iteration i
              i = BigInt(i + 1);           // Increment the iteration counter
            }
            return r;
          }
          var hyperMode = false; // Initially not in hyper mode
          function toggleHyperMode () {
            hyperMode = !hyperMode;
            toggleHyperMode1();
            toggleHyperMode2();
          }
          function toggleHyperMode1() {
              var hyperButton = document.querySelector('.calb[value="⇧"]');
              if (hyperMode == true) {
                console.log("Hypermode is active")
                // Toggle the functionality of the buttons based on hyper mode
                var buttonsToUpdate = [
                    { value: "^^", replacementValue: "ln", onclick: function() { appendText('ln('); } },
                    { value: "^", replacementValue: "n√", onclick: function() { appendText('nthRoot('); } },
                    { value: "1", replacementValue: "i", onclick: function() { document.calculator.ans.value+="sqrt(-1)";document.calculator.ansTwo.value+='i'; } },
                    { value: "2", replacementValue: "²", onclick: function() { document.calculator.ans.value+="** 2";document.calculator.ansTwo.value+='²'; } },
                    { value: "3", replacementValue: "³", onclick: function() { document.calculator.ans.value+="** 3";document.calculator.ansTwo.value+='³'; } },
                    { value: "4", replacementValue: "ⁿ√", onclick: function() { document.calculator.ans.value+="nrt(";document.calculator.ansTwo.value+='nrt('; } },
                    { value: "5", replacementValue: "√", onclick: function() { document.calculator.ans.value+="sqrt(";document.calculator.ansTwo.value+='√('; } },
                    { value: "6", replacementValue: "∛", onclick: function() { appendText('cbrt('); } },
                    { value: "7", replacementValue: "!", onclick: function() { appendText('!'); } },
                    { value: "8", replacementValue: "$", onclick: function() { appendText('$'); } },
                    { value: "9", replacementValue: "log₂", onclick: function() { appendText('log<sub>2</sub>(', '(1/log(2))/log('); } },
                    { value: "(-)", replacementValue: "%", onclick: function() { appendText('%'); } },
                    { value: "0", replacementValue: "log₁₀", onclick: function() { appendText('log<sub>10</sub>(', 'log('); } },
                    { value: "aⁿ", replacementValue: "ⁿa", onclick: function() { appendText('^^'); } },
                ];
            
                buttonsToUpdate.forEach(button => {
                    var buttonElement = document.querySelector(`input[type="button"][value="${button.value}"].calb`);
                    if (buttonElement) {
                        if (hyperMode) {
                            buttonElement.value = button.replacementValue;
                            buttonElement.onclick = button.onclick;
                        } else {
                            buttonElement.value = button.value;
                            buttonElement.onclick = function() { appendText(button.value); };
                        }
                    }
                });
              }
              else {
                // Revert the buttons to their original values and functionalities
                var buttonsToRevert = [
                  { value: "i", originalValue: "1", onclick: function() { appendText('1'); } },
                  { value: "²", originalValue: "2", onclick: function() { appendText('2'); } },
                  { value: "³", originalValue: "3", onclick: function() { appendText('3'); } },
                  { value: "ⁿ√", originalValue: "4", onclick: function() { appendText('4'); } },
                  { value: "√", originalValue: "5", onclick: function() { appendText('5'); } },
                  { value: "∛", originalValue: "6", onclick: function() { appendText('6'); } },
                  { value: "!", originalValue: "7", onclick: function() { appendText('7'); } },
                  { value: "$", originalValue: "8", onclick: function() { appendText('8'); } },
                  { value: "log₂", originalValue: "9", onclick: function() { appendText('9'); } },
                  { value: "log₁₀", originalValue: "0", onclick: function() { appendText('0'); } },
                ];
            
                buttonsToRevert.forEach(button => {
                    var buttonElement = document.querySelector(`input[type="button"][value="${button.value}"].calb`);
                    if (buttonElement) {
                        buttonElement.value = button.originalValue;
                        buttonElement.onclick = button.onclick;
                    }
                });
              }
            console.log("Task completed successfully");
          }
          function toggleHyperMode2() {
              var hyperButton = document.querySelector('.calo[value="⇧"]');
              if (hyperMode == true) {
                console.log("Hypermode is active")
                // Toggle the functionality of the buttons based on hyper mode
                var buttonsToUpdate = [
                    { value: "^^", replacementValue: "ln", onclick: function() { appendText('ln('); } },
                    { value: "^", replacementValue: "n√", onclick: function() { appendText('nthRoot('); } },
                ];
            
                buttonsToUpdate.forEach(button => {
                    var buttonElement = document.querySelector(`input[type="button"][value="${button.value}"].calb`);
                    if (buttonElement) {
                        if (hyperMode) {
                            buttonElement.value = button.replacementValue;
                            buttonElement.onclick = button.onclick;
                        } else {
                            buttonElement.value = button.value;
                            buttonElement.onclick = function() { appendText(button.value); };
                        }
                    }
                });
              }
              else {
                // Revert the buttons to their original values and functionalities
                var buttonsToRevert = [
                  { value: "^^", originalValue: "ln", onclick: function() { appendText('^^'); } },
                  { value: "^", originalValue: "n√", onclick: function() { appendText('**'); } },
                ];
            
                buttonsToRevert.forEach(button => {
                    var buttonElement = document.querySelector(`input[type="button"][value="${button.value}"].calo`);
                    if (buttonElement) {
                        buttonElement.value = button.originalValue;
                        buttonElement.onclick = button.onclick;
                    }
                });
              }
            console.log("Task completed successfully");
          }
          function evaluateExpression() {
              var ansField = document.calculator.ans;
              var ansTwoField = document.calculator.ansTwo.replace(/([\d\w\)\.]+)\s*\^\^\s*([\d\w\(\)\.]+)/g, 'tet($1,$2)').replace(/\|([^|]+)\|/g, 'abs($1)').replace('{','(').replace('}', ')');;
              let scope = {
                x: math.complex(x, i),
                tet: tet,
              };
              
              ansField.value = eval(ansField.value);
              ansTwoField.value = math.evaluate(ansTwoField.value);
          }

          function appendText(text, text2=text) {
              var ansField = document.calculator.ans;
              var ansTwoField = document.calculator.ansTwo;
              
              ansField.innerHTML += text;
              ansTwoField.value += text;
          }

          
          var fakeResult = document.getElementById('resultFake');
          document.addEventListener("keydown", function (event) {
            if (event.key === "Shift") {
              toggleHyperMode();
            }
          });

          document.addEventListener("keyup", function (event) {
            if (event.key === "Shift") {
              toggleHyperMode();
            }
          });
        </script>
      </div>
      <div id='algebra' class='content-section'>
        <h1 class="page-title">Algebra</h1>
        <div class="desk-paper" style='line-height: 36pt;'>
          <button id='geometry-toggle'>Geometry</button>
          <div id="regularPolygonArea" onmouseover="polygon.areaR();">
            <h2>Regular Polygon / Polygram Area</h2>
            <span id='geometry-polygon'>
              <span id='geometry-sides-text'>Sides</span> (&#x2265;<span id='geometry-minsides'>3</span>):
              <input
                type="number"
                min="3"
                id="sidesCRPA"
                value="3"
                step="1"
                onkeyup="polygon.areaR();"
              /><br/>
            </span>
            <span id='geometry-polygram' style='display: none;'>
              Connection By (&#x2265;1)
              <input
                type="number"
                min="1"
                id="sidesCRPAPGD"
                value="2"
                step="1"
                onkeyup="polygon.areaR();"
              /><br/>
            </span>
            Side Length (&gt;0):<input
              type="number"
              min="0"
              id="lengthCRPA"
              value="6"
              step="0.1"
              onkeyup="polygon.areaR();"
            /><br/>
            <p><input type='checkbox' id='geometry-gongram' onclick='polygon.gongram();polygon.areaR();'/> <label for='geometry-gongram'>Polygram?</label></p>
            <p>Area: <span id="areaCRPA"></span></p>
            <script>
              var polygon = {
                areaR: function (n1, s1) {
                  var minSides = 3;
                  var n = Number(document.getElementById("sidesCRPA").value);
                  if (polygon.isPolygram === true) {
                    n /= Number(document.getElementById("sidesCRPAPGD").value);
                    minSides = 0;
                  }
                  var s = Number(document.getElementById("lengthCRPA").value);
                  if (n1 != undefined) {
                    n = n1;
                  }
                  if (s1 != undefined) {
                    s = s1;
                  }

                  // Actual area calculation
                  var area0 = ((1 / 4) * n * (s * s) * 1) / Math.tan(Math.PI / n);
                  var area = Math.round(area0 * 100000000) / 100000000;

                  if (n >= minSides && s > 0 && Number(document.getElementById("sidesCRPA").value) % 1 == 0 && Number(document.getElementById("sidesCRPAPGD").value) % 1 == 0 && $('#sidesCRPAPGD').value % $('#sidesCRPA').value != 0) {
                    // special cases
                    if (n == 2) area = 0;
                    if (n < 2) area = Math.abs(area);
                    // put values
                    if (!(n1 == undefined || s1 == undefined)) return area;
                    document.getElementById("areaCRPA").innerText = area;
                  }
                  else {
                    document.getElementById("areaCRPA").innerText = "Invalid inputs.";
                  }
                },
                isPolygram: false,
                gongram: function () {
                  polygon.isPolygram = !polygon.isPolygram;
                  if ($('#geometry-gongram').checked == true) {
                    if (Number(document.getElementById("sidesCRPA").value) < 5) document.getElementById("sidesCRPA").value = 5;
                    $('#geometry-polygram').style.display = 'block';
                    $('#geometry-sides-text').innerHTML = 'Convex Vertices';
                    $('#geometry-minsides').innerHTML = '5';
                  }
                  else {
                    $('#geometry-polygram').style.display = 'none';
                    $('#geometry-sides-text').innerHTML = 'Sides';
                    $('#geometry-minsides').innerHTML = '3';
                  }
                },
                round5: function (input) {
                  var k = round(input, 1);
                  if (input < k && input < k - 2.5) return k - 5;
                  if (input >= k && input >= k + 2.5) return k + 5;
                  else return k;
                }
              };
            </script>
          </div>
          <hr />
          <div id="pascalsSimplex" onmouseover="pascal.calc();">
            <h2>Pascal's <var>m</var>-simplex</h2>
            Dimension &#x2115;(m&#x2265;2):
            <input
              type="number"
              min="1"
              id="dimensionsCPS"
              value="2"
              step="1"
              oninput="pascal.addDimension();"
            />
            <div id="addDimensionsCPS"></div>
            <p>Value: <span id="valueCPS"></span></p>
            <script>
              var pascal = {
                oldNoD: 2,
                addDimension: function () {
                  var noD = Number(
                    document.getElementById("dimensionsCPS").value
                  );
                  var adC = document.getElementById("addDimensionsCPS");
                  adC.innerHTML = "";
                  if (noD < 1) {
                    adC.innerHTML = "Invalid dimension.";
                  }
                  for (var i = 0; i <= noD - 2; i++) {
                    if (i != 0) {
                      adC.innerHTML += "<br/>";
                    }
                    adC.innerHTML +=
                      "<var>n</var><sub>" +
                      i +
                      "</sub> &#x2115;(0 <u>&lt;</u> <var>n</var><sub>" +
                      i +
                      "</sub> <u>&lt;</u> <var>n</var><sub>" +
                      (i + 1) +
                      '</sub>): <input type="number" min="0" id="n' +
                      i +
                      'CPS" value="2" step="1" onkeyup="pascal.findMax();"/>';
                  }
                  adC.innerHTML +=
                    "<br/><var>n</var><sub>" +
                    (noD - 1) +
                    "</sub> &#x2115;(0 <u>&lt;</u> <var>n</var><sub>" +
                    (noD - 1) +
                    '</sub> <u>&lt;</u> &#x221e;): <input type="number" min="0" id="n' +
                    (noD - 1) +
                    'CPS" value="2" step="1" onkeyup="pascal.findMax();"/>';
                },
                fixMax: function () {
                  var noD = Number(
                    document.getElementById("dimensionsCPS").value
                  );
                  for (var i = 0; i <= noD - 1; i++) {
                    var z = Number(
                      document.querySelector("#n" + (i + 1) + "CPS").value
                    );
                    document.querySelector("#n" + i + "CPS").max = z;
                  }
                },
                factorial: function (n) {
                  if (n <= 1) {
                    return 1;
                  } else {
                    let result = 1;
                    for (let i = 1; i <= n; i++) {
                      result *= i;
                    }
                    return result;
                  }
                },
                calc: function () {
                  var m = Number(document.getElementById("dimensionsCPS").value);
                  var a = 1;
                  var cont = true;
                  for (var i = 0; i <= m - 1; i++) {
                    var first = document.querySelector("#n" + i + "CPS").value;
                    var second = Infinity;
                    if (i + 1 != m) {
                      second = document.querySelector(
                        "#n" + (i + 1) + "CPS"
                      ).value;
                    }
                    if (first > second || first < 0) {
                      cont = false;
                      a = "Invalid inputs.";
                      break;
                    }
                  }
                  for (var p = 1; p <= m - 1 && cont == true; p++) {
                    var np = Number(
                      document.getElementById("n" + p + "CPS").value
                    );
                    var np_1 = Number(
                      document.getElementById("n" + (p - 1).toString() + "CPS")
                        .value
                    );
                    a *=
                      pascal.factorial(np) /
                      (pascal.factorial(np_1) * pascal.factorial(np - np_1));
                  }
                  document.getElementById("valueCPS").innerText = a;
                },
              };
              $(document).ready(() => {
                pascal.addDimension();
              });
            </script>
          </div>
          <br/><br/><br/><br/><br/><br/>
        </div>
      </div>

      <div id='units' class='content-section active'>
        <h1 class="page-title">Units</h1>
        <div class="desk-paper" style='line-height: 36pt;'>
          <table class='non'>
            <thead>
              <tr>
                <td colspan='3'>
                  <select id='conv-unit-type' oninput='selectUnitType();'>
                    <optgroup label='Base units'>
                      <option value='length'>Length</option>
                      <option value='time'>Time</option>
                      <option value='weight'>Weight</option>
                      <option value='mass'>Mass</option>
                      <option value='current'>Electric current</option>
                      <option value='substance'>Substance</option>
                      <option value='luminosity'>Luminous intensity</option>
                      <option value='currency'>Currency</option>
                    </optgroup>
                    <optgroup label='Derived units'>
                      <option value='solid'>Solid volume</option>
                      <option value='fluid'>Fluid volume</option>
                      <option value='area'>Area</option>
                      <option value='frequency'>Frequency</option>
                      <option value='speed'>Speed</option>
                      <option value='angle'>Angle</option>
                      <option value='angle3d'>3D angle</option>
                      <option value='angle4d'>4D angle</option>
                      <option value='radiation'>Radiation dose</option>
                    </optgroup>
                  </select>
                </td>
              <tr>
                <td>Unit</td>
                <td>-</td>
                <td>Convert</td>
              </tr>
            </thead>
            <tbody id='conv-body'>
              <tr>
                <td>
                  <span id='conv-length-first-container'>
                    
                  </span>
                  <!--<select id='conv-time-first'>
                    <optgroup label='Ubiquitous'>
                      <option value='s'><i>Second (s or sec)</i></option>
                    </optgroup>
                    <optgroup label='Imperial'>
                      <option value='fth'><i>Fourth (fth)</i></option>
                      <option value='thd'><i>Third (thd)</i></option>
                      <option value='min'><i>Minute (min)</i></option>
                      <option value='hr'><i>Hour (hr)</i></option>
                      <option value='d'><i>Day (d)</i></option>
                      <option value='w'><i>Week (w)</i></option>
                      <option value='lm'><i>Lunar Month (lm)</i></option>
                      <option value='ifcm'><i>International Fixed Calendar Month (IFCM)</i></option>
                      <option value='agm'><i>Average Gregorian Month (AGM)</i></option>
                      <option value='yr'><i>Julian year (y)</i></option>
                      <option value='lyr'><i>Lunar year (lyr)</i></option>
                      <option value='oyr'><i>Orbital year (oyr)</i></option>
                      <option value='gyr'><i>Galactic year (gyr)</i></option>
                    </optgroup>
                  </select>-->
                  <br/>
                  <input type='number' id='conv-length-input' value='1'/>
                </td>
                <td>
                  <button id='conv-length-btn'>Convert</button><br/>
                  <button id='conv-length-flip'>Flip</button>
                </td>
                <td>
                  <span id='conv-length-second-container'>
                  </span>
                  <br/>
                  <input type='number' id='conv-length-output' value='72' readonly/>
                </td>
              </tr>
              <div class='hidden' id='conv-length-options'>
                <optgroup label='Imperial'>
                  <option value='th'><i>Thou (th)</i></option>
                  <option value='tw'><i>Twip (tw)</i></option>
                  <option value='pt'>Point (pt)</option>
                  <option value='pc'><i>Pica (pc)</i></option>
                  <option value='ps'><i>Poppyseed (ps)</i></option>
                  <option value='bc'><i>Barleycorn (bc)</i></option>
                  <option value='in' selected='selected'>Inch (in)</option>
                  <option value='hd'><i>Hand (hd)</i></option>
                  <option value='lk'>Link (lk)</option>
                  <option value='ft'>Foot (ft)</option>
                  <option value='yd'>Yard (yd)</option>
                  <option value='rd'>Rod (rd)</option>
                  <option value='ch'><i>Chain (ch)</i></option>
                  <option value='fl'>Furlong (fl)</option>
                  <option value='mi'>Mile (mi)</option>
                  <option value='lg'>League (lg)</option>
                </optgroup>
                <optgroup label='Metric/SI'>
                  <option value='qm'>Quectometre (qm)</option>
                  <option value='rm'>Rontometre (rm)</option>
                  <option value='ym'>Yoctometre (ym)</option>
                  <option value='zm'>Zeptometre (zm)</option>
                  <option value='am'>Attometre (am)</option>
                  <option value='fm'>Femtometre (fm)</option>
                  <option value='åm'>Ångstrom (Å)</option>
                  <option value='pm'>Picometre (pm)</option>
                  <option value='nm'>Nanometre (nm)</option>
                  <option value='μm'>Micrometre (μm)</option>
                  <option value='mam'>Myriometre (mam)</option>
                  <option value='mm'>Millimetre (mm)</option>
                  <option value='cm'>Centimetre (cm)</option>
                  <option value='dm'>Decimetre (dm)</option>
                  <option value='m'>Metre (m)</option>
                  <option value='dkm'>Dekametre (dkm)</option>
                  <option value='hm'>Hectometre (hm)</option>
                  <option value='km'>Kilometre (km)</option>
                  <option value='mym'>Myriametre (mym)</option>
                  <option value='mmm'>Megametre (Mm)</option>
                  <option value='ggm'>Gigametre (Gm)</option>
                  <option value='ttm'>Terametre (Tm)</option>
                  <option value='ppm'>Petametre (Pm)</option>
                  <option value='eem'>Exametre (Em)</option>
                  <option value='zzm'>Zettametre (Zm)</option>
                  <option value='yym'>Yottametre (Ym)</option>
                  <option value='rrm'>Ronnametre (Rm)</option>
                  <option value='qqm'>Quettametre (Qm)</option>
                  <option value='kqqm'>Kiloquettametre (kQm)</option>
                  <option value='myqqm'>Myriaquettametre (myQm)</option>
                  <option value='mmqqm'>Megaquettametre (MQm)</option>
                  <option value='ggqqm'>Gigaquettametre (GQm)</option>
                  <option value='ttqqm'>Teraquettametre (TQm)</option>
                </optgroup>
                <optgroup label='Other + Humourous'>
                  <option value='parsec'>Parsec</option>
                  <option value='ly'>Light year (ly)</option>
                  <option value='au'>Astronomical unit (AU)</option>
                  <option value='pl'>Planck length (pl)</option>
                  <option value='aparsec'>Attoparsec</option>
                  <option value='smoot'>Smoot</option>
                  <option value='s-d'>Light second (ls)</option>
                  <option value='min-d'>Light minute (lmin)</option>
                  <option value='hr-d'>Light hour (lhr)</option>
                  <option value='d-d'>Light day (ld)</option>
                  <option value='w-d'>Light week (lw)</option>
                  <option value='fn-d'>Light fortnight (lfn)</option>
                  <option value='lm-d'>Light lunar month (llm)</option>
                  <option value='jjy-d'>Light Julian year (lJy)</option>
                  <option value='ly-d'>Light lunar year (lly)</option>
                  <option value='oy-d'>Light orbital year (loy)</option>
                  <option value='gy-d'>Light galactic year (lgy)</option>
                </optgroup>
              </div>
            </tbody>
          </table>
          <style>
            #conv-body tr trd {display: none;}
            select option i {font-family: times;}
          </style>
          <script>
            var lengthSelect = $('#conv-length-options');
            $('#conv-length-first-container').innerHTML = "<select id='conv-length-first'>" + lengthSelect + "</select>";
            $('#conv-length-second-container').innerHTML = "<select id='conv-length-second'>" + lengthSelect + "</select>";
            // Length conversions
            const lengthFactors = {
              // --- Imperial (inches as base) ---
              'th': 1 / 1000,
              'tw': 1 / 1440,
              'pt': 1 / 72,
              'pc': 1 / 6,
              'ps': 1 / 85.5,
              'bc': 1 / 3,
              'in': 1,
              'hd': 4,
              'lk': 7.92,
              'ft': 12,
              'yd': 36,
              'rd': 198,
              'ch': 792,
              'fl': 7920,
              'mi': 63360,
              'lg': 190080,

              // --- Metric (metres as base, then converted to inches) ---
              'qm': 3.937e-14,
              'rm': 3.937e-13,
              'ym': 3.937e-12,
              'zm': 3.937e-11,
              'am': 3.937e-10,
              'fm': 3.937e-9,
              'åm': 3.937e-9,
              'pm': 3.937e-8,
              'nm': 3.937e-6,
              'μm': 3.937e-5,
              'mm': 0.03937,
              'cm': 0.3937,
              'dm': 3.937,
              'm': 39.37,
              'dkm': 393.7,
              'hm': 3937,
              'km': 39370,
              'mam': 393700,
              'mmm': 39370000,
              'ggm': 3.937e10,
              'ttm': 3.937e13,
              'ppm': 3.937e16,
              'eem': 3.937e19,
              'zzm': 3.937e22,
              'yym': 3.937e25,
              'rrm': 3.937e28,
              'qqm': 3.937e31,
              'kqqm': 3.937e34,
              'myqqm': 3.937e35,
              'mmqqm': 3.937e37,
              'ggqqm': 3.937e40,
              'ttqqm': 3.937e43,
              'ppqqm': 3.937e46,
              'eeqqm': 3.937e49,
              'zzqqm': 3.937e52,
              'yyqqm': 3.937e55,
              'rrqqm': 3.937e58,
              'qqqqm': 3.937e61,

              // --- Astronomical + Funny Units (converted to inches) ---
              'pl': 6.3e-35 * 39.37,
              'smoot': 67,
              'aparsec': 1.012e21,
              'parsec': 3.08567758e18 * 39.37,
              'ly': 9.461e15 * 39.37,
              'au': 1.496e11 * 39.37,

              // --- Patellian ---
              'H': pl * 2 * 60 ** 19;
            };
            const timeFactors = {
              // --- Seconds ---
              's': 1,
              
              // --- Imperial --
              'fth': 1/3600,
              'thd': 1/60,
              'min': 60,
              'hr': 3600,
              'd': 86400,
              'w': 86400 * 7,
              'lm': 86400 * 29.5, // Lunar month
              'ifcm': 86400 * 28, // International Fixed Calendar month
              'agm': 86400 * 30.3375, // Average Gregorian month
              'yr': 86400 * 365,
              'lyr': 86400 * 29.5 * 12,
              'oyr': 86400 * 365.2422,
              'gyr': 86400 * 365 * 2.2e8,

              // --- Metric ---
            }

            document.getElementById('conv-length-btn').addEventListener('click', function () {
              const fromUnit = document.getElementById('conv-length-first').value;
              const toUnit = document.getElementById('conv-length-second').value;
              const input = parseFloat(document.getElementById('conv-length-input').value);

              if (isNaN(input)) {
                alert('Please enter a valid number');
                return;
              }
              const inches = input * (lengthFactors[fromUnit] || 1);
              const converted = inches / (lengthFactors[toUnit] || 1);

              document.getElementById('conv-length-output').value = converted;
              // Assuming you have jQuery or a similar library for '$'
              // If not, these lines will cause an error and should be replaced with native JS
              document.getElementById('conv-length-input').style.color = 'black';
              document.getElementById('conv-length-output').style.color = 'black';
            });

            // Flip button
            document.getElementById('conv-length-flip').addEventListener('click', function () {
              const select1 = document.getElementById('conv-length-first');
              const select2 = document.getElementById('conv-length-second');

              const tempValue = select1.value;
              select1.value = select2.value;
              select2.value = tempValue;

              // Optional: also swap the values if you want to visually reverse them
              const input = document.getElementById('conv-length-input');
              const output = document.getElementById('conv-length-output');

              const tempNum = input.value;
              input.value = output.value;
              output.value = tempNum;
              input.style.color = 'red';
              output.style.color = 'red';
            });
          </script>
        </div>
      </div>

      <div id='chemistry' class='content-section active'>
        <h1 class="page-title">Chemistry</h1>
        <div class="desk-paper" style='line-height: 36pt;'>
          <h2>Chemical Element Information</h2>
          <div class='table-wrapper'>
            <table class='non'>
              <thead>
                <tr>
                  <td colspan='2' style='width: 50%;'>Property</td>
                  <td style='width: 50%;'>Value</td>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td rowspan='7'><strong>Nomenclature</strong></td>
                  <td><strong>Atomic Number</strong></td>
                  <td><input type='number' oninput='showElement(this.value)' style='max-width: 100%; width: 100%; text-align: center;' min='-174' max='174' id='atom-num'/></td>
                  <!--<td id='atom-num'>?</td>-->
                </tr>
                <tr>
                  <td><strong>Element Name</strong></td>
                  <td id='atom-name'>?</td>
                </tr>
                <tr>
                  <td><strong>Covalent Name</strong></td>
                  <td id='atom-covalent'>?</td>
                </tr>
                <tr>
                  <td><strong>Element Symbol</strong></td>
                  <td id='atom-symbol'>?</td>
                </tr>
                <tr>
                  <td><strong>Element Coordinate</strong></td>
                  <td id='atom-coords'>?</td>
                </tr>
                <tr>
                  <td><strong>Atomic Mass</strong></td>
                  <td id='atom-mass'>?</td>
                </tr>
                <tr>
                  <td><strong>Element Type</strong></td>
                  <td id='atom-type'>?</td>
                </tr>
                <tr>
                  <td rowspan='6'><strong>Phases</strong></td>
                  <td><strong>Melting Point (<abbr title='standard temperature and pressure'>STP</abbr>)</strong></td>
                  <td id='atom-melt'>?</td>
                </tr>
                <tr>
                  <td><strong>Boiling Point (STP)</strong></td>
                  <td id='atom-boil'>?</td>
                </tr>
                <tr>
                  <td><strong>Heat of Ionisation</strong></td>
                  <td id='atom-plasma'>?</td>
                </tr>
                <tr>
                  <td><strong>Triple Point</strong></td>
                  <td id='atom-triple'>?</td>
                </tr>
                <tr>
                  <td><strong>Critical Point</strong></td>
                  <td id='atom-supercritical'>?</td>
                </tr>
                <tr>
                  <td><strong>Heat of Fusion</strong></td>
                  <td id='atom-fusion'>?</td>
                </tr>
                <tr>
                  <td rowspan='4'><strong>Abundance</strong>
                  <td><strong>Discovery</strong></td>
                  <td id='atom-discovery'>?</td>
                </tr>
                <tr>
                  <td><strong>Synthetic?</strong></td>
                  <td id='atom-synthetic'>?</td>
                </tr>
                <tr>
                  <td><strong>Common Isotopes</strong></td>
                  <td id='atom-isotopes'>?</td>
                </tr>
                <tr>
                  <td><strong>Price</strong></td>
                  <td id='atom-price'>?</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <script>
          const periodicTable = [
            [0, 'neutronium', 'neutride', 'Nu', [0,0], 1.67492749804, 'theoretical', null, null],
            [1, 'hydrogen', 'hydride', 'H', [1,1], 1.008, 'nonmetal', -259.16, -252.87],
            [2, 'helium', 'helide', 'He', [18,1], 4.002602, 'noble gas', -272.2, -268.93],
            [3, 'lithium', 'lithide', 'Li', [1,2], 6.94, 'alkali metal', 180.54, 1342],
            [4, 'beryllium', 'beryllide', 'Be', [2,2], 9.0122, 'alkaline earth metal', 1287, 2469],
            [5, 'boron', 'boride', 'B', [13,2], 10.81, 'metalloid', 2075, 4000],
            [6, 'carbon', 'carbide', 'C', [14,2], 12.011, 'nonmetal', 3550, 4827],
            [7, 'nitrogen', 'nitride', 'N', [15,2], 14.007, 'nonmetal', -210.1, -195.79],
            [8, 'oxygen', 'oxide', 'O', [16,2], 15.999, 'nonmetal', -218.79, -182.95],
            [9, 'fluorine', 'fluoride', 'F', [17,2], 18.998, 'halogen', -219.67, -188.11],
            [10, 'neon', 'neide', 'Ne', [18,2], 20.180, 'noble gas', -248.59, -246.08],
            [11, 'sodium', 'natride', 'Na', [1,3], 22.990, 'alkali metal', 97.72, 883],
            [12, 'magnesium', 'magneside', 'Mg', [2,3], 24.305, 'alkaline earth metal', 650, 1090],
            [13, 'aluminium', 'alumide', 'Al', [13,3], 26.982, 'post-transition metal', 660.3, 2470],
            [14, 'silicon', 'silicide', 'Si', [14,3], 28.085, 'metalloid', 1414, 3265],
            [15, 'phosphorous', 'phosphide', 'P', [15,3], 30.974, 'nonmetal', 44.15, 280.5],
            [16, 'sulphur', 'sulphide', 'S', [16,3], 32.06, 'nonmetal', 115.21, 444.6],
            [17, 'chlorine', 'chloride', 'Cl', [17,3], 35.45, 'halogen', -101.5, -34.04],
            [18, 'argon', 'argide', 'Ar', [18,3], 39.948, 'noble gas', -189.34, -185.85],
            [19, 'potassium', 'potasside', 'K', [1,4], 39.098, 'alkali metal', 63.5, 759],
            [20, 'calcium', 'calcide', 'Ca', [2,4], 40.078, 'alkaline earth metal', 842, 1484],
            [21, 'scandium', 'scandide', 'Sc', [3,4], 44.956, 'transition metal', 1541, 2836],
            [22, 'titanium', 'titanide', 'Ti', [4,4], 47.867, 'transition metal', 1668, 3287],
            [23, 'vanadium', 'vanadide', 'V', [5,4], 50.942, 'transition metal', 1910, 3407],
            [24, 'chromium', 'chromide', 'Cr', [6,4], 51.996, 'transition metal', 1907, 2671],
            [25, 'manganese', 'manganide', 'Ma', [7,4], 54.938, 'transition metal', 1244, 2095],
            [26, 'iron', 'ferride', 'Fe', [8,4], 55.845, 'transition metal', 1538, 2862],
            [27, 'cobalt', 'cobaltide', 'Co', [9,4], 58.933, 'transition metal', 1495, 2927],
            [28, 'nickel', 'nickelide', 'Ni', [10,4], 58.693, 'transition metal', 1455, 2730],
            [29, 'copper', 'cupride', 'Cu', [11,4], 63.546, 'transition metal', 1085, 2562],
            [30, 'zinc', 'zincide', 'Zn', [12,4], 65.38, 'transition metal', 419.5, 907],
            [31, 'gallium', 'gallide', 'Ga', [13,4], 69.723, 'post-transition metal', 29.76, 2204],
            [32, 'germanium', 'germanide', 'Ge', [14,4], 72.63, 'metalloid', 938.3, 2833],
            [33, 'arsenic', 'arsenide', 'As', [15,4], 74.922, 'metalloid', 817, 614],
            [34, 'selenium', 'selenide', 'Se', [16,4], 78.971, 'nonmetal', 221, 685],
            [35, 'bromine', 'bromide', 'Br', [17,4], 79.904, 'halogen', -7.2, 58.8],
            [36, 'krypton', 'kryptide', 'Kr', [18,4], 83.798, 'noble gas', -157.4, -153.22],
            [37, 'rubidium', 'rubide', 'Rb', [1,5], 85.468, 'alkali metal', 39.3, 688],
            [38, 'strontium', 'strontide', 'Sr', [2,5], 87.62, 'alkaline earth metal', 777, 1382],
            [39, 'yttrium', 'yttride', 'Y', [3,5], 88.906, 'transition metal', 1526, 3337],
            [40, 'zirconium', 'zirconide', 'Zr', [4,5], 91.224, 'transition metal', 1855, 4377],
            [41, 'niobium', 'niobide', 'Nb', [5,5], 92.906, 'transition metal', 2477, 4744],
            [42, 'molybdenum', 'molybdenide', 'Mb', [6,5], 95.95, 'transition metal', 2623, 4639],
            [43, 'technetium', 'technetide', 'Tc', [7,5], 98, 'transition metal', 2157, 4265],
            [44, 'ruthenium', 'ruthenide', 'Ru', [8,5], 101.07, 'transition metal', 2334, 4150],
            [45, 'rhodium', 'rhodide', 'Rh', [9,5], 102.91, 'transition metal', 1964, 3727],
            [46, 'palladium', 'palladide', 'Pd', [10,5], 106.42, 'transition metal', 1554, 2963],
            [47, 'silver', 'argentide', 'Ar', [11,5], 107.87, 'transition metal', 961.8, 2162],
            [48, 'cadmium', 'cadmide', 'Cd', [12,5], 112.41, 'transition metal', 321.07, 767],
            [49, 'indium', 'indide', 'In', [13,5], 114.82, 'post-transition metal', 156.6, 2072],
            [50, 'tin', 'stannide', 'Sn', [14,5], 118.71, 'post-transition metal', 231.93, 2602],
            [51, 'antimony', 'stibide', 'Sb', [15,5], 121.76, 'metalloid', 630.63, 1587],
            [52, 'tellurium', 'telluride', 'Te', [16,5], 127.6, 'metalloid', 449.5, 988],
            [53, 'iodine', 'iodide', 'I', [17,5], 126.90, 'halogen', 113.7, 184.3],
            [54, 'xenon', 'xenide', 'Xe', [18,5], 131.29, 'noble gas', -111.8, -108.1],
            [55, 'caesium', 'caeside', 'Cs', [1,6], 132.91, 'alkali metal', 28.44, 671],
            [56, 'barium', 'baride', 'Ba', [2,6], 137.33, 'alkaline earth metal', 727, 1897],
            [57, 'lanthanum', 'lanthanide', 'La', [3,6], 138.91, 'lanthanide', 920, 3464],
            [58, 'cerium', 'cereide', 'Ce', [4,6], 140.12, 'lanthanide', 795, 3426],
            [59, 'praseodymium', 'praseodymide', 'Pr', [5,6], 140.91, 'lanthanide', 931, 3127],
            [60, 'neodymium', 'neodymide', 'Nd', [6,6], 144.24, 'lanthanide', 1024, 3074],
            [61, 'promethium', 'promethide', 'Pm', [7,6], 145, 'lanthanide', 1042, 3000],
            [62, 'samarium', 'samaride', 'Sm', [8,6], 150.36, 'lanthanide', 1072, 1794],
            [63, 'europium', 'europium', 'Eu', [9,6], 151.96, 'lanthanide', 822, 1597],
            [64, 'gadolinium', 'gadolinide', 'Gd', [10,6], 157.25, 'lanthanide', 1313, 3273],
            [65, 'terbium', 'terbide', 'Tb', [11,6], 158.93, 'lanthanide', 1356, 3230],
            [66, 'dysprosium', 'dysproside', 'Dy', [12,6], 162.50, 'lanthanide', 1412, 2562],
            [67, 'holmium', 'holmide', 'Ho', [13,6], 164.93, 'lanthanide', 1474, 2700],
            [68, 'erbium', 'erbide', 'Er', [14,6], 167.26, 'lanthanide', 1529, 2868],
            [69, 'thulium', 'thulide', 'Tm', [15,6], 168.93, 'lanthanide', 1545, 1950],
            [70, 'ytterbium', 'ytterbide', 'Yb', [16,6], 173.05, 'lanthanide', 824, 1196],
            [71, 'lutetium', 'lutetide', 'Lu', [17,6], 174.97, 'lanthanide', 1663, 3402],
            [72, 'hafnium', 'hafnide', 'Hf', [4,6], 178.49, 'transition metal', 2233, 4603],
            [73, 'tantalum', 'tantalide', 'Ta', [5,6], 180.95, 'transition metal', 3017, 5458],
            [74, 'tungsten', 'wolframide', 'W', [6,6], 183.84, 'transition metal', 3422, 5555],
            [75, 'rhenium', 'rhenide', 'Rh', [7,6], 186.21, 'transition metal', 3186, 5596],
            [76, 'osmium', 'osmide', 'Os', [8,6], 190.23, 'transition metal', 3045, 5027],
            [77, 'iridium', 'iridide', 'Ir', [9,6], 192.22, 'transition metal', 2446, 4130],
            [78, 'platinum', 'platinide', 'Pt', [10,6], 195.08, 'transition metal', 1768, 3825],
            [79, 'gold', 'auride', 'Au', [11,6], 196.97, 'transition metal', 1064, 2856],
            [80, 'mercury', 'hydragyride', 'Hg', [12,6], 200.59, 'transition metal', -38.83, 357],
            [81, 'thallium', 'thallide', 'Tl', [13,6], 204.38, 'post-transition metal', 304, 1473],
            [82, 'lead', 'plumbide', 'Pb', [14,6], 207.2, 'post-transition metal', 327.46, 1749],
            [83, 'bismuth', 'bismide', 'Bi', [15,6], 208.98, 'post-transition metal', 271.5, 1564],
            [84, 'polonium', 'polonide', 'Po', [16,6], 209, 'post-transition metal', 254, 962],
            [85, 'astatine', 'astatide', 'As', [17,6], 210, 'halogen', 302, 337],
            [86, 'radon', 'randide', 'Rn', [18,6], 222, 'noble gas', -71, -61.7],
            [87, 'francium', 'francide', 'Fr', [1,7], 223, 'alkali metal', 27, 677],
            [88, 'radium', 'radide', 'Ra', [2,7], 226, 'alkaline earth metal', 700, 1737],
            [89, 'actinium', 'actinide', 'Ac', [3,7], 227, 'actinide', 1050, 3200],
            [90, 'thorium', 'thoride', 'Th', [4,7], 232.04, 'actinide', 1750, 4800],
            [91, 'protractinium', 'protractinide', 'Pa', [5,7], 231.04, 'actinide', 1572, 4000],
            [92, 'uranium', 'uranide', 'U', [6,7], 238.03, 'actinide', 1132, 4131],
            [93, 'neptunium', 'neptunide', 'Np', [7,7], 237, 'actinide', 640, 3900],
            [94, 'plutonium', 'plutonide', 'Pu', [8,7], 244, 'actinide', 640, 3235],
            [95, 'americium', 'americide', 'Am', [9,7], 243, 'actinide', 1176, 2607],
            [96, 'curium', 'curide', 'Cm', [10,7], 247, 'actinide', 1340, 3110],
            [97, 'berkelium', 'berkelide', 'Bk', [11,7], 247, 'actinide', 986, 2627],
            [98, 'californium', 'californide', 'Cf', [12,7], 251, 'actinide', 900, 1743],
            [99, 'einsteinium', 'einsteinide', 'Es', [13,7], 252, 'actinide', 860, null],
            [100, 'fermium', 'fermide', 'Fm', [14,7], 257, 'actinide', null, null],
            [101, 'mendelevium', 'mendelevide', 'Md/Mv', [15,7], 258, 'actinide', null, null],
            [102, 'nobelium', 'nobelide', 'No', [16,7], 259, 'actinide', null, null],
            [103, 'lawrencium', 'lawrencide', 'Lr', [17,7], 262, 'actinide', null, null],
            [104, 'rutherfordium', 'rutherfordide', 'Rf', [4,8], 267, 'transition metal', null, null],
            [105, 'dubnium', 'dubnide', 'Db', [5,8], 268, 'transition metal', null, null],
            [106, 'seaborgium', 'seaborgide', 'Sg', [6,8], 269, 'transition metal', null, null],
            [107, 'bohrium', 'bohride', 'Bh', [7,8], 270, 'transition metal', null, null],
            [108, 'hassium', 'hasside', 'Hs', [8,8], 269, 'transition metal', null, null],
            [109, 'meitnerium', 'meitneride', 'Mt', [9,8], 278, 'transition metal', null, null],
            [110, 'darmstadtium', 'darmstadtide', 'Ds', [10,8], 281, 'transition metal', null, null],
            [111, 'röntgenium', 'röntgenide', 'Rg', [11,8], 282, 'transition metal', null, null],
            [112, 'copernicium', 'copernicide', 'Cn', [12,8], 285, 'transition metal', null, null],
            [113, 'nihonium', 'nihonide', 'Nh', [13,8], 286, 'post-transition metal', null, null],
            [114, 'flerovium', 'flerovide', 'Fl', [14,8], 289, 'post-transition metal', null, null],
            [115, 'moscovium', 'muscovide', 'Mc', [15,8], 290, 'post-transition metal', null, null],
            [116, 'livermorium', 'livermoride', 'Lr', [16,8], 293, 'post-transition metal', null, null],
            [117, 'tennessine', 'tennesside', 'Ts', [17,8], 294, 'halogen', null, null],
            [118, 'oganesson', 'oganesside', 'Og', [18,8], 294, 'noble gas', null, null],
            [119, 'ununennium', 'ununennide', 'Uue', [1,9], 315, 'alkali metal', null, null],
            [120, 'unbinilium', 'unbinilide', 'Ubn', [2,9], 320, 'alkaline earth metal', null, null],
            [121, 'unbiunium', 'unbiunide', 'Ubu', [3,9], 321, 'superactinide', null, null],
            [122, 'unbibium', 'unbibide', 'Ubb', [4,9], 322, 'superactinide', null, null],
            [123, 'unbitrium', 'unbitride', 'Ubt', [5,9], 323, 'superactinide', null, null],
            [124, 'unbiquadium', 'unbiquadide', 'Ubq', [6,9], 324, 'superactinide', null, null],
            [125, 'unbipentium', 'unbipentide', 'Ubp', [7,9], 325, 'superactinide', null, null],
            [126, 'unbihexium', 'unbihexide', 'Ubh', [8,9], 326, 'superactinide', null, null],
            [127, 'unbiseptium', 'unbiseptide', 'Ubs', [9,9], 327, 'superactinide', null, null],
            [128, 'unbioctium', 'unbioctide', 'Ubo', [10,9], 328, 'superactinide', null, null],
            [129, 'unbiennium', 'unbiennide', 'Ube', [11,9], 329, 'superactinide', null, null],
            [130, 'untrinilium', 'untrinilide', 'Utn', [12,9], 330, 'superactinide', null, null],
            [131, 'untriunium', 'untriunide', 'Utu', [13,9], 331, 'superactinide', null, null],
            [132, 'untribium', 'untribide', 'Utb', [14,9], 332, 'superactinide', null, null],
            [133, 'untritrium', 'untritride', 'Utt', [15,9], 333, 'superactinide', null, null],
            [134, 'untriquadium', 'untriquadide', 'Utq', [16,9], 334, 'superactinide', null, null],
            [135, 'untripentium', 'untripentide', 'Utp', [17,9], 335, 'superactinide', null, null],
            [136, 'untrihexium', 'untrihexide', 'Uth', [18,9], 336, 'superactinide', null, null],
            [137, 'feynmanium', 'feynmanide', 'Fy', [1,10], 337, 'superactinide', null, null]
          ];
          periodicTable[undefined] = [undefined, 'muonium', 'muide', 'Mu', [-1, 0], 0.113, 'exotic', null, null];
          periodicTable[312] = [312, 'obamium', 'obamide', 'Ob', [-1, 0], 0.113, 'fictional meme alkali metal', 15, 630];
          periodicTable[Infinity] = [Infinity, 'infinitium', 'infinitite', 'If', [-1, 0], Infinity, 'fictional material', Infinity, Infinity];
          periodicTable[-312] = [-312, 'antiobamium', 'antiobamide', '-Ob', [-1, 0], 0.113, 'fictional meme antialkali metal', 15, 630];
          periodicTable[-Infinity] = [-Infinity, 'antinfinitium', 'antinfinitite', '-If', [-1, 0], -Infinity, 'fictional antimaterial', -Infinity, -Infinity];
          for (var i = 138; i <= 174; i += 1) {
            var type;
            if (i <= 143) type = 'superactinide';
            else if (i > 143 && i <= 157) type = 'unquadquadide';
            else if (i > 157 && i <= 166) type = 'transition metal';
            else if (i > 166 && i <= 169) type = 'post-transition metal';
            else if (i == 170) type = 'metalloid';
            else if (i == 171) type = 'halogen';
            else if (i == 172) type = 'noble gas';
            else if (i == 173) type = 'alkali metal';
            else if (i == 174) type = 'alkaline earth metal';
            else if (i < 174) type = 'impossible'
            else type = 'exotic';
            var suffa = ['Un', 'U'];
            var suffb, suffc;
            var j = i - 100;
            var k = j;
            switch (k % 10) {
              case 0:
                suffc = ['nil', 'n'];
                break;
              case 1:
                suffc = ['un', 'u'];
                break;
              case 2:
                suffc = ['bi', 'b'];
                break;
              case 3:
                suffc = ['tri', 't'];
                break;
              case 4:
                suffc = ['quad', 'q'];
                break;
              case 5:
                suffc = ['pent', 'p'];
                break;
              case 6:
                suffc = ['hex', 'h'];
                break;
              case 7:
                suffc = ['sept', 's'];
                break;
              case 8:
                suffc = ['oct', 'o'];
                break;
              default:
                suffc = ['enn', 'n'];
            }
            switch ((j - (k % 10))/10 % 100) {
              case 0:
                suffb = ['nil', 'n'];
                break;
              case 1:
                suffb = ['un', 'u'];
                break;
              case 2:
                suffb = ['bi', 'b'];
                break;
              case 3:
                suffb = ['tri', 't'];
                break;
              case 4:
                suffb = ['quad', 'q'];
                break;
              case 5:
                suffb = ['pent', 'p'];
                break;
              case 6:
                suffb = ['hex', 'h'];
                break;
              case 7:
                suffb = ['sept', 's'];
                break;
              case 8:
                suffb = ['oct', 'o'];
                break;
              default:
                suffb = ['enn', 'n'];
            }
            periodicTable[i] = [i, suffa[0].toLowerCase() + suffb[0] + suffc[0] + 'ium', suffa[0].toLowerCase() + suffb[0] + suffc[0] + 'ide', suffa[1].toString() + suffb[1] + suffc[1], [1+i, 10], 0.113, type, null, null];
          }
          for (var i = -1; i >= -174; i -= 1) periodicTable[i] = [i, 'anti' + periodicTable[-i][1], 'anti' + periodicTable[-i][2] + 'ide', periodicTable[-i][3] + '&#x0305;', periodicTable[-i][4], periodicTable[-i][5] + ' (antimatter)', 'anti-' + periodicTable[-i][6], periodicTable[-i][7], periodicTable[-i][8]];
          function showElement (number = 1) {
            if ((number > 174) && number != 312) {
              $('#atom-num').value = NaN;
              number = Infinity;
            }
            if ((number < -174) && number != -312) {
              $('#atom-num').value = NaN;
              number = -Infinity;
            }
            $('#atom-num').value = periodicTable[number][0];
            $('#atom-name').innerHTML = periodicTable[number][1];
            $('#atom-covalent').innerHTML = periodicTable[number][2];
            $('#atom-symbol').innerHTML = periodicTable[number][3];
            $('#atom-coords').innerHTML = periodicTable[number][4];
            $('#atom-mass').innerHTML = periodicTable[number][5];
            $('#atom-type').innerHTML = periodicTable[number][6];
            $('#atom-melt').innerHTML = periodicTable[number][7];
            $('#atom-boil').innerHTML = periodicTable[number][8];
          }
        </script>
      </div>

      <!-- Learn Section -->
      <div id="learn" class="content-section">
        <h1 class="page-title">Learn</h1>
        <div class="desk-paper">
          <!-- Learn content here -->
          <div id="home">
            <input
              type="file"
              id="aryaFile"
              accept=".arya"
              style="margin-bottom: 10px"
            />
            <button class="button hidden" id="importBtn">
              <i class="fa fa-upload"></i> Import .arya
            </button>
            <button class="button" id="playBtn">
              <i class="fa fa-gamepad"></i> Play
            </button>
          </div>
          <div id="incorrect" style="display: none">
            <center>
              <strong>
                <span>That answer was&nbsp;</span>
                <i style="text-decoration: underline; color: red">WRONG</i>
                <span>&nbsp;&#x203c;</span>
              </strong>
            </center>
          </div>
          <div id="game" class="hidden">
            <div class="question" id="question">Question</div>
            <div class="answers" id="answers"></div>
            <div id="score">
              <span id="scoreText">Score</span>:
              <span id="scoreValue">0 <span id="langSilver">silver</span></span>
              | <span id="totalRight">0</span>/<span id="totalQuestions"
                >0</span
              >
              — <span id="percentage">0</span>%
            </div>
            <!--<input
              type="text"
              id="textInput"
              placeholder="Type your answer here..."
            />-->
            <button class="button" id="resetBtn">Reset</button>
            <!--<button class="button" id="shopBtn">Shop</button>-->
          </div>
        </div>
        <script>
          // Script for learn tab
          let questions = [];
          let currentQuestionIndex = 0;
          let oldCqi;
          let olderCqi;
          let specCqi;
          let silver = 0;
          let halvePenalty = false;
          // Language-specific strings
          var noFileMessage = "No file selected!!!";
          var langSilver = "silver";
          // Total right and total questions
          let totalQuestions = 0;
          let totalRight = 0;

          // Parse the .arya file with the new format
          function parseArya(arya) {
            const rows = arya.split("\n");
            questions = []; // Clear existing questions
            rows.forEach((row) => {
              const values = row.split(",");
              if (values.length === 7) {
                try {
                  const answers = [
                    values[1].trim(), // Incorrect answer 1
                    values[2].trim(), // Incorrect answer 2
                    values[3].trim(), // Incorrect answer 3
                    values[4].trim(), // Correct answer
                  ];
                  questions.push({
                    question: values[0].trim(),
                    correct: values[4].trim(),
                    choices: answers,
                    pointsAwarded: parseInt(values[5]),
                    pointsDeducted: parseInt(values[6]),
                  });
                } catch (error) {
                  console.error("Error parsing row:", row, error);
                }
              }
            });
            if (questions.length === 0) {
              alert(
                "No valid questions found in the file. Please check the format."
              );
            }
          }

          // Shuffle answers randomly
          function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
              const j = Math.floor(Math.random() * (i + 1));
              [array[i], array[j]] = [array[j], array[i]];
            }
          }

          function loadQuestion() {
            if (currentQuestionIndex >= questions.length) {
              currentQuestionIndex == 1;
              /*alert("Game Over! Your total: " + silver + " " + langSilver);
              $("#game").hide();
              $(".container").show();
              currentQuestionIndex = 0;
              silver = 0;
              $("#scoreValue").text(silver + " " + langSilver);*/
              return;
            }

            const current = questions[currentQuestionIndex];
            $("#question").text(current.question);

            // Randomize the order of answers
            const randomizedChoices = [...current.choices];
            shuffle(randomizedChoices);

            // Create answer buttons
            const answerButtons = randomizedChoices
              .map((choice, index) => {
                return `<button class="button answer">${String.fromCharCode(
                  65 + index
                )}: ${choice}</button>`;
              })
              .join("");
            $("#answers").html(answerButtons);

            // Handle answer selection
            $(".answer").on("click", function () {
              const selectedAnswer = $(this).text().split(":")[1].trim();
              if (selectedAnswer === current.correct) {
                // Add the appropriate amount of silver
                silver += current.pointsAwarded;
                // Increment the number of questions gotten right
                totalRight += 1;
                // Leave a gap of at least 2 between the same exact question
                olderCqi = oldCqi;
                oldCqi = currentQuestionIndex;
                do {
                  specCqi = Math.round(Math.random() * questions.length);
                } while (specCqi == oldCqi || specCqi == olderCqi);
                currentQuestionIndex = specCqi;
              } else {
                // Show the incorrect dialogue box
                $("#incorrect").show();
                $("#game").hide();
                // Hide the incorrect dialogue box after ~2/3 of a second
                setTimeout(function () {
                  $("#incorrect").hide();
                  $("#game").show();
                }, 666.6);
                // If the halve-penalty powerup is equipped from the shop, half the penalty from the silver amount
                silver -= halvePenalty
                  ? Math.ceil(current.pointsDeducted / 2)
                  : current.pointsDeducted;
                // Repeat the question if it was incorrectly answered
                currentQuestionIndex = currentQuestionIndex;
              }
              // Increment the total numbers of questions answered
              totalQuestions += 1;
              document.getElementById("totalQuestions").innerHTML = totalQuestions;
              // Apply changes to number of questions gotten right
              document.getElementById("totalRight").innerHTML = totalRight;
              document.getElementById("percentage").innerHTML =
                Math.round((totalRight / totalQuestions) * 1000) / 10;
              $("#scoreValue").text(silver + " " + langSilver);
              //currentQuestionIndex++;
              // Disable receiving the same question twice in a row or too often

              loadQuestion();
            });

            // Handle text input submission
            $("#textInput").on("keypress", function (e) {
              if (e.which === 13) {
                // Enter key
                const userAnswer = $(this).val().trim();
                if (userAnswer === current.correct) {
                  // Add the appropriate amount of silver
                  silver += current.pointsAwarded;
                  // Increment the number of questions gotten right
                  totalRight += 1;
                  // Leave a gap of at least 2 between the same exact question
                  olderCqi = oldCqi;
                  oldCqi = currentQuestionIndex;
                  do {
                    specCqi = Math.round(Math.random() * questions.length);
                  } while (specCqi == oldCqi || specCqi == olderCqi);
                  currentQuestionIndex = specCqi;
                } else {
                  // Show the incorrect dialogue box
                  $("#incorrect").show();
                  $("#game").hide();
                  // Hide the incorrect dialogue box after ~2/3 of a second
                  setTimeout(function () {
                    $("#incorrect").hide();
                    $("#game").show();
                  }, 666.6);
                  // If the halve-penalty powerup is equipped from the shop, half the penalty from the silver amount
                  silver -= halvePenalty
                    ? Math.ceil(current.pointsDeducted / 2)
                    : current.pointsDeducted;
                  // Repeat the question if it was incorrectly answered
                  currentQuestionIndex = currentQuestionIndex;
                }
                // Increment the total numbers of questions answered
                totalQuestions += 1;
                document.getElementById("totalQuestions").innerHTML =
                  totalQuestions;
                // Apply changes to number of questions gotten right
                document.getElementById("totalRight").innerHTML = totalRight;
                document.getElementById("percentage").innerHTML =
                  Math.round((totalRight / totalQuestions) * 1000) / 10;
                $("#scoreValue").text(silver + " " + langSilver);
                // Clear the input field
                $(this).val("");
                loadQuestion();
              }
            });
          }

          $("#importBtn").on("click", function () {
            const fileInput = document.getElementById("aryaFile");
            const file = fileInput.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onload = function (e) {
                parseArya(e.target.result);
                ///alert("Arya imported successfully!");
              };
              reader.readAsText(file);
            } else {
              alert(noFileMessage);
            }
          });

          $("#playBtn").on("click", function () {
            $("#questions").show();
            document.getElementById("importBtn").click();
            setTimeout(function () {
              if (questions.length === 0) {
                //alert("Please import a .arya file first!");
                return;
              }
              $("#game").show();
              $("#home").hide();
              $("#textInput").hide();
              loadQuestion();
            }, 36);
          });

          $("#typeBtn").on("click", function () {
            document.getElementById("importBtn").click();
            setTimeout(function () {
              if (questions.length === 0) {
                //alert("Please import a .arya file first!");
                return;
              }
              $(".container").hide();
              $("#game").fadeIn();
              $("#answers").hide();
              loadQuestion();
            }, 36);
          });

          $("#resetBtn").on("click", function () {
            // Confirm if the user wants to reset
            var resetConf = confirm("Are you sure you would like to reset?");
            if (resetConf === true) {
              // Remove all questions
              questions = [];

              // Set question index to 0
              currentQuestionIndex = 0;

              // Deduct all silver
              silver = 0;

              // Reset number of right and wrong
              totalRight = 0;
              totalQuestions = 0;

              // Update score value
              $("#scoreValue").text(silver + " " + langSilver);

              // Update percentage and right and wrong
              document.getElementById("totalRight").innerHTML = 0;
              document.getElementById("totalQuestions").innerHTML = 0;
              document.getElementById("percentage").innerHTML = 0;

              // Hide the game and return to the home screen
              $("#game").hide();
              $("#home").fadeIn();
            }
          });
          $(document).ready(function () {
            if (
              window.matchMedia &&
              window.matchMedia("(prefers-color-scheme: dark)").matches
            ) {
              $("body").addClass("dark");
            }

            window
              .matchMedia("(prefers-color-scheme: dark)")
              .addEventListener("change", (event) => {
                if (event.matches) {
                  $("body").addClass("dark");
                } else {
                  $("body").removeClass("dark");
                }
              });
            if (window.location.href.indexOf("#home") > -1 || window.location.href.indexOf("graphing") > -1 || window.location.href.indexOf("main") > -1) {
              document.querySelector("#homeTab").click();
            }
            else if (window.location.href.indexOf("#scientific") > -1) {
              document.querySelector("#scientificTab").click();
            }
            else if (window.location.href.indexOf("#algebra") > -1) {
              document.querySelector("#algebraTab").click();
            }
            else if (window.location.href.indexOf("#units") > -1) {
              document.querySelector("#unitsTab").click();
            }
            else if (window.location.href.indexOf("#chemistry") > -1) {
              document.querySelector("#chemistryTab").click();
            }
            else if (window.location.href.indexOf("#learn") > -1) {
              document.querySelector("#learnTab").click();
            }
            else if (window.location.href.indexOf("#memorise") > -1 || window.location.href.indexOf("#memorize") > -1) {
              document.querySelector("#memoriseTab").click();
            }
            else if (window.location.href.indexOf("#parse") > -1) {
              document.querySelector("#parse").click();
            }
            else {
              document.querySelector("#homeTab").click();
            }
          });
        </script>
      </div>

      <!-- Memorise Applet -->
      <div id="memorise" class="content-section">
        <h1 class="page-title">Memorise</h1>
        <div class="desk-paper">
          <div id='dpM-sans-script'>
            <!-- Memorise content here -->
            <div id="memoriseHome">
              <strong>paste below what you'd like to memorise:</strong>
              <br />
              <textarea
                id="memoriseBoxM"
                style="
                  width: 100%;
                  height: 100px;
                  font-family: times;
                  font-size: 12pt;
                  padding: 8pt;
                "
              ></textarea>
              <button id="submitBtnM">Submit Text</button>
            </div>
            <div
              id="memoriseInterface"
              style="display: none"
              onmouseover="document.querySelector('#memBox').focus();"
            >
              <div id="memShow" style="border: 1px double grey; padding: 9pt">
                <b style="font-family: courier; color: navy">|</b>
              </div>
              <hr />
              <div contenteditable id="memBox" style="color: transparent"></div>
              <style>
                #memBox:focus {
                  outline: 0;
                  border: 0;
                  cursor: vertical-text;
                }
              </style>
              <p>Count: <span id="charCount">0</span> characters</p>
              <div id="wrongsM"></div>
              <button id='resetBtnM'>Reset</button>
            </div>
          </div>

          <script>
            {
              var memText = "Lorem ipsum";
              var memPrac = document.getElementById("memBox").innerText.trim();
              var memPracU = document.getElementById("memBox").innerText;
              var charCount = 0;
              var oldCharCount = 0;
              var newOldCharCount = 0;
              var memShow = false;
              var memDone = false;
              var memWrongs = 0;
              document
                .querySelector("#submitBtnM")
                .addEventListener("click", function () {
                  memShow = true;
                  $("#memoriseHome").fadeOut(1000);
                  $("#memoriseInterface").fadeIn(2000);
                  memText = document.getElementById("memoriseBoxM").value.trim();
                });
              document
                .querySelector("#resetBtnM")
                .addEventListener("click", function () {
                  memText = "Lorem ipsum";
                  memPrac = document.getElementById("memBox").innerText.trim();
                  memPracU = document.getElementById("memBox").innerText;
                  charCount = 0;
                  oldCharCount = 0;
                  newOldCharCount = 0;
                  memShow = false;
                  memDone = false;
                  memWrongs = 0;
                  document.querySelector('#dpM-sans-script').innerHTML = '<div id=memoriseHome><strong>paste below what you&#x0027;d like to memorise:</strong><br><textarea id=memoriseBoxM style=width:100%;height:100px;font-family:times;font-size:12pt;padding:8pt></textarea> <button id=submitBtnM>Submit Text</button></div><div id=memoriseInterface style=display:none onmouseover="document.querySelector("#memBox").focus()"><div id=memShow style="border:1px double grey;padding:9pt"><b style=font-family:courier;color:navy>|</b></div><hr><div id=memBox style=color:transparent contenteditable></div><style>#memBox:focus{outline:0;border:0;cursor:vertical-text}</style><p>Count: <span id=charCount>0</span> characters<div id=wrongsM></div><button id=resetBtnM>Reset</button></div>';
                });
              document
                .querySelector("#memoriseInterface")
                .addEventListener("click", function (e) {
                  document.querySelector("#memBox").focus();
                });
              document
                .querySelector("#memBox")
                .addEventListener("click", function (e) {
                  e.preventDefault();
                });
              document
                .querySelector("#memBox")
                .addEventListener("input", function (e) {
                  if (
                    event.key === "ArrowUp" ||
                    event.key === "ArrowDown" ||
                    event.key === "ArrowLeft" ||
                    event.key === "ArrowRight"
                  ) {
                    e.preventDefault();
                  } else {
                    memPracU = document.getElementById("memBox").innerText;
                    memPrac = memPracU.trim();
                    document.querySelector("#memShow").innerHTML =
                      memPracU +
                      "<b style='font-family: courier; color: navy;'>|</b>";
                    //document.querySelector('#memBox').innerHTML = memPrac;
                    // move cursor to end
                    oldCharCount = charCount;
                    charCount = memPrac.length;
                    document.getElementById("charCount").innerText = charCount;
                    if (
                      charCount != 0 &&
                      memPrac.charAt(charCount - 1) !=
                        memText.charAt(charCount - 1)
                    ) {
                      document.querySelector("#wrongsM").innerHTML +=
                        "Error at position " + (charCount - 1) + ".<br/>";
                      var memBoxA = document
                        .querySelector("#memBox")
                        .innerText.slice(0, -1);
                      var memBoxB = document
                        .querySelector("#memBox")
                        .innerText.slice(-1, charCount);
                      document.querySelector("#memShow").innerHTML =
                        memBoxA + "<u style='color: red;'>" + memBoxB + "</u>";
                      memWrongs += 1;
                    }
                  }
                  if (
                    memShow === true &&
                    memPracU.length >= memText.length
                  ) {
                    var þ = document.querySelector("#wrongsM").innerHTML;
                    var itD = 0;
                    if (memPrac.length == memText.length && itD == 0) {
                      if (memWrongs != 0) {
                        document.querySelector("#wrongsM").innerHTML =
                          "<strong style='color: green;'>DONE</strong><br/><p><small>" +
                          memWrongs +
                          " total mistakes</small><hr/>" +
                          þ;
                      } else {
                        document.querySelector("#wrongsM").innerHTML =
                          "<strong style='color: green;'>DONE</strong><br/><p><small style='cursor: n-resize;'>No mistakes&#x203c;</small>";
                      }
                      itD += 1;
                      memDone = true;
                    } else if (memPrac.length > memText.length) {
                      document.querySelector("#wrongsM").innerHTML =
                        "<strong style='color: brown;'>OVERFLOW</strong><br/>" +
                        þ;
                    }
                  }
                  if (memDone === true) {
                    document.activeElement.blur();
                    document.querySelector("#memBox").innerHTML = memText;
                    document.querySelector("#memBox").style.display = "none";
                    document.querySelector("#memBox").contenteditable = "false";
                  }
                });
            }
            
          </script>
        </div>
      </div>

      <!-- Parse Section -->
      <div id="parse" class="content-section">
        <h1 class="page-title">Parse</h1>
        <div class="desk-paper">
          <strong>enter your text to parse in simple sentences separated by line:</strong><br />
          <textarea
            id="parseBoxP"
            style="
              width: 100%;
              height: 100px;
              font-family: times;
              font-size: 12pt;
              padding: 8pt;
            "
          ></textarea>
          <button id="submitBtnP">Submit Text</button>
          <div style="border: 1px solid black" id="resultBoxP"></div>
          <script>
            document
              .querySelector("#submitBtnP")
              .addEventListener("click", function (e) {
                var a = document
                  .querySelector("#parseBoxP")
                  .value
                  .replaceAll("!", ".")
                  .replaceAll("?", ".")
                  .replaceAll(";", ".")
                  .toLowerCase()
                  .replaceAll(/[^a-zA-Z0-9.!?,;\s]/g, "");
                var b = a
                  .replace(/\. /g, ".")
                  .replace(/\. /g, ",")
                  .replaceAll(/\. /g, "!")
                  .replaceAll(/\. /g, "?")
                  .replaceAll(/\. /g, ";");
                // Arrays
                var c = b.split(".");
                var verb = [];
                var questionTF = [];
                // Initial Reset
                document.querySelector("#resultBoxP").innerHTML = "";
                for (var i = 0; i < c.length; i += 1) {
                  document.querySelector("#resultBoxP").innerHTML +=
                    c[i] + "<br/>";
                }
                document.querySelector("#resultBoxP").innerHTML += "<hr/>Verbs:<br/>";             
                for (var i = 0; i < c.length; i += 1) {
                  var d = nlp(c[i]).verbs().text();
                  verb.push(d);
                  document.querySelector("#resultBoxP").innerHTML += d + "<br/>"
                }
                document.querySelector("#resultBoxP").innerHTML += "<hr/>True-False Questions:<br/>";
                for (var i = 0; i < verb.length; i += 1) {
                  var e;
                  if (verb[i] == "is" || verb[i] == "are" || verb[i] == "am" || verb[i] == "was" || verb[i] == "were" || verb[i] == "isnt" || verb[i] == "arent" || verb[i] == "aint" || verb[i] == "wasnt" || verb[i] == "werent") {
                    e = verb[i] + " " + nlp(c[i]).nouns().text() + "?";
                  }
                  else {
                    var eStart = "Does";
                    /*if (nlp(c[i]).nouns().text().isPlural().out('array')[0] != undefined) {
                      eStart = "Do";
                    }*/
                    e = eStart + " " + nlp(c[i]).nouns().eq(0).text() + " " + nlp(c[i]).verbs().text() + " " + nlp(c[i]).nouns().eq(1).text() + "?";
                  }
                  questionTF.push(e);
                  document.querySelector("#resultBoxP").innerHTML += e + "<br/>"
                }
                // document.querySelector("#resultBoxP").innerHTML += "<hr/>Questions:<br/>";
                // var e = Math.random();
                /*if (e <= 0.33) {
                  // True-false question 1/3 of the time
                  for (var i = 0; i < verb.length; i += 1) {
                    var f = "Does " + nlp(c[i].verbs().text()) + verb[i] + "?";
                    questions.push(f);
                    document.querySelector("#resultBoxP").innerHTML += f + "<br/>";
                  }
                }
                else {
                  
                }*/
              });
          </script>
        </div>
      </div>
    </div>



    <nav class='nav-bar'>
      <div class='nav-item' data-target='#graphing' id='homeTab'>
        <i class='fa-solid fa-pencil'></i>
        Graphing
      </div>
      <div class='nav-item' data-target='#scientific' id='scientificTab'>
        <i class='fa-solid fa-calculator'></i>
        Scientific
      </div>
      <div class='nav-item' data-target='#algebra' id='algebraTab'>
        <i class='fa-solid fa-microchip'></i>
        Algebra
      </div>
      <div class='nav-item' data-target='#units' id='unitsTab'>
        <i class='fa-solid fa-ruler'></i>
        Units
      </div>
      <div class='nav-item' data-target='#chemistry' id='chemistryTab'>
        <i class='fa-solid fa-flask'></i>
        Chemistry
      </div>
      <div class='nav-item' data-target='#learn' id='learnTab'>
        <i class='fa-solid fa-brain'></i>
        Learn
      </div>
      <div class='nav-item' data-target='#memorise' id='memoriseTab'>
        <i class='fa-solid fa-book-open'></i>
        Memorise
      </div>
      <div class='nav-item' data-target='#parse' id='parseTab'>
        <i class='fa-solid fa-box-open'></i>
        Parse
      </div>
    </nav>


    <style>input[type=number]{max-width:100px;}</style>
    
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.2/math.js'></script>
    <script src="http://aryabhata.aeonic.me/noedit.compromise.js"></script>
    <style>
      @font-face {
        font-family: 'display';
        src: url('display.ttf') format('truetype');
      }
      /* The browser window */
      #scientific .calcinterface {
        border: 3px solid #f1f1f1;
        border-top-left-radius: 4px;
        border-top-right-radius: 4px;
      }
      
      /* Container for columns and the top "toolbar" */
      #scientific .row {
        padding: 10px;
        background: navy;
        border-top-left-radius: 4px;
        border-top-right-radius: 4px;
      }
      
      /* Create three unequal columns that floats next to each other */
      #scientific .column {
        float: left;
      }
      
      #scientific .left {
        width: 15%;
      }
      
      #scientific .right {
        width: 10%;
      }
      
      #scientific .middle {
        width: 75%;
      }
      
      /* Clear floats after the columns */
      #scientific .row:after {
        content: "";
        display: table;
        clear: both;
      }
      
      /* Three dots */
      #scientific .dot {
        margin-top: 4px;
        height: 12px;
        width: 12px;
        background-color: #bbb;
        border-radius: 50%;
        display: inline-block;
        border: 1px solid white;
      }
      
      /* Style the input field */
      #scientific input[type=text] {
        width: 100%;
        border-radius: 3px;
        border: none;
        background-color: white;
        margin-top: -8px;
        height: 25px;
        color: #666;
        padding: 5px;
      }
      
      /* Three bars (hamburger menu) */
      #scientific .bar {
        width: 17px;
        height: 3px;
        background-color: #aaa;
        margin: 3px 0;
        display: block;
      }
      
      /* Page content */
      #scientific .clontent {
        padding: 10px;
      }
      #scientific .calb {
        border: 3.5px solid black;
        margin-right: 0px;
      }
      #scientific .caln {
        background-color: gold;
      }
      #scientific .cala {
        background-color: silver;
        border: 3.5px solid black;
        margin-right: 0px;
      }
      #scientific .calo {
        background-color: #967444;
        border: 3.5px solid black;
        margin-right: 0px;
      }
      .cala, .calb, .calo {
        width: 20%;
        max-width: calc(100% - 12px);
        height: 20%;
        max-height: calc(100% - 12px);
        height: 120px;
        font-size: 80px;
      }
      #scientific #result, #scientific #resultFake {
        border: 4px solid green;
        background-color: #967444;
        color: green;
        height: 54px;
        max-height: 54px;
        font-weight: bold;
        font-size: 42px;
        overflow: auto;
      }
      #scientific .calv {
        background-color: #FF9900; /* Customize the color as needed */
        border: 3.5px solid black;
        margin-right: 0px;
      }
      #scientific div#calculator {
        width: 100%;
        background-color: black;
      }
      /*#scientific .numrow {display: flex; width: 100%;}*/
      #scientific form table {width: 100%;}
      #scientific table td {width: 20%;}
      #scientific table td input[type] {width: 100%; font-family: futura; font-size: 30px;}
      #scientific #resultFake::placeholder {
        color: red;
      }
      #scientific table {
        border-collapse: separate;
        border-spacing: 6px;
        word-wrap: break-word;
      }

      #scientific td {
        text-align: center;
        padding: 6px;
      }

      /* Learn App Styling */
      #learn .desk-paper {
        /* Inherits all the base desk-paper styles */
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      #learn .question {
        font-size: 1.5em;
        margin-bottom: 20px;
        text-align: center;
        color: #442200;
        text-shadow: 1px 1px 0 rgba(255, 255, 255, 0.5);
        padding: 15px;
        background: rgba(255, 255, 255, 0.3);
        border-radius: 8px;
        border: 1px solid rgba(0, 0, 0, 0.1);
        width: 100%;
      }

      #learn .answers {
        display: grid;
        grid-template-columns: 1fr;
        gap: 15px;
        width: calc(100%-4px);
        margin-left: 2px;
        margin-right: 2px;
        max-width: 1200px;
      }

      #learn .button {
        width: 100%;
        padding: 15px;
        font-size: 1.1em;
        background: linear-gradient(to bottom, #f0e6d2, #e0d0a0);
        border: 1px solid #b5a269;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1),
          inset 0 1px 2px rgba(255, 255, 255, 0.5);
        color: #442200;
        cursor: pointer;
        transition: all 0.2s ease;
        text-align: center;
      }

      #learn .button:hover {
        background: linear-gradient(to bottom, #f5ebd7, #e5d5a5);
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15),
          inset 0 1px 2px rgba(255, 255, 255, 0.5);
      }

      #learn .button:active {
        transform: translateY(1px);
        background: linear-gradient(to bottom, #e0d0a0, #f0e6d2);
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      #learn #score {
        margin-top: 20px;
        padding: 10px 15px;
        background: rgba(255, 255, 255, 0.3);
        border-radius: 8px;
        border: 1px solid rgba(0, 0, 0, 0.1);
        text-align: center;
        font-size: 1.1em;
        color: #442200;
      }

      #learn input[type="file"] {
        margin: 15px 0;
        padding: 10px;
        background: rgba(255, 255, 255, 0.3);
        border-radius: 8px;
        border: 1px solid #b5a269;
        width: 100%;
        max-width: 400px;
      }

      /* Dark mode adjustments */
      @media (prefers-color-scheme: dark) {
        #learn .question {
          color: #e0e0e0;
          background: rgba(50, 50, 50, 0.5);
          text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.5);
        }

        #learn .button {
          background: linear-gradient(to bottom, #3a3a3a, #2a2a2a);
          border-color: #444;
          color: #e0e0e0;
        }

        #learn .button:hover {
          background: linear-gradient(to bottom, #4a4a4a, #3a3a3a);
        }

        #learn .button:active {
          background: linear-gradient(to bottom, #2a2a2a, #3a3a3a);
        }

        #learn #score {
          background: rgba(50, 50, 50, 0.5);
          color: #e0e0e0;
        }

        #learn input[type="file"] {
          background: rgba(50, 50, 50, 0.5);
          border-color: #444;
          color: #e0e0e0;
        }
      }
    </style>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Select home tab
        const navItems = document.querySelectorAll('.nav-item');
        const contentSections = document.querySelectorAll('.content-section');
        
        // Function to handle nav item clicks
        function handleNavClick(event) {
          const targetId = this.getAttribute('data-target');
          
          // Hide all content sections
          contentSections.forEach(section => {
            section.classList.remove('active');
          });
          
          // Show the targeted section
          document.querySelector(targetId).classList.add('active');
          
          // Reset all nav items
          navItems.forEach(item => {
            item.style.transform = 'translateY(0)';
            item.style.background = 'transparent';
          });
          
          // Style the clicked nav item
          this.style.background = 'rgba(255,255,255,0.3)';
          this.style.transform = 'translateY(-5px)';
        }
        
        // Add click event to each nav item
        navItems.forEach(item => {
          item.addEventListener('click', handleNavClick);
        });
        
        // Click the first nav item by default
        document.querySelector('.nav-item').click();
      });
      
    </script>
  </body>
</html>
